<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom">
  <generator uri="http://jekyllrb.com" version="3.9.0">Jekyll</generator>
  <link href="http://maximomussini.com/feed.xml" rel="self" type="application/atom+xml" />
  <link href="http://maximomussini.com/" rel="alternate" type="text/html" />
  <updated>2020-12-06T19:21:52-03:00</updated>
  <id>http://maximomussini.com/</id>
  <title>MÃ¡ximo Mussini</title>
  <subtitle>Thoughts about development and product design.</subtitle>
  <author>
    <name>MÃ¡ximo Mussini</name>
    <email>maximomussini@gmail.com</email>
  </author>

  <entry>
    <title>Practical Applications of the Singleton Class in Ruby</title>
    <link href="http://maximomussini.com/posts/practical-applications-of-the-singleton-class/" rel="alternate" type="text/html" title="Practical Applications of the Singleton Class in Ruby" />
    <published>2020-12-06T00:00:00-03:00</published>
  
    <updated>2020-12-06T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/practical-applications-of-the-singleton-class</id>
    <content type="html" xml:base="http://maximomussini.com/posts/practical-applications-of-the-singleton-class/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/practical-applications-of-the-singleton-class.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;In the &lt;a href=&quot;/posts/understanding-the-singleton-class&quot;&gt;previous post&lt;/a&gt;, we discussed how the &lt;em&gt;singleton class&lt;/em&gt; powers class methods in Ruby, and how every object instance has &lt;a href=&quot;/posts/understanding-the-singleton-class&quot;&gt;&lt;em&gt;its own&lt;/em&gt; singleton class&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In this post, we will cover a few practical usages of the &lt;em&gt;singleton class&lt;/em&gt; as a way to modify the behavior of a particular object.&lt;/p&gt;

&lt;h2 id=&quot;adding-methods-and-mixins&quot;&gt;Adding Methods and Mixins&lt;/h2&gt;

&lt;p&gt;Since the &lt;em&gt;singleton class&lt;/em&gt; of an object is specific to it, we can add methods to it, remove methods, or include modules, all without affecting other instances.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;When calling a method on an object, Ruby will first look into its singleton class to find it, before traversing the rest of the &lt;a href=&quot;/posts/understanding-the-singleton-class/#the-metaclass-hierarchy&quot;&gt;method chain&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;defining-singleton-methods&quot;&gt;Defining Singleton Methods&lt;/h3&gt;

&lt;p&gt;Letâ€™s cover a few of the syntaxes we can use to define methods for a specific object.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_singleton_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;'Alice'&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; in &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;location&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;'Wonderland'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;to_s&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inspect&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Alice in Wonderland: #&amp;lt;Object:0x00007fe7b5071238&amp;gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The last two syntaxes should be familiar, we usually use them inside a class definition with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;self&lt;/code&gt; as the receiver (inside the class definition &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;self&lt;/code&gt; is the class object).&lt;/p&gt;

&lt;p&gt;These four different ways of defining a method are equivalent, each one is defining a &lt;em&gt;&lt;strong&gt;singleton method&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A &lt;em&gt;&lt;strong&gt;singleton method&lt;/strong&gt;&lt;/em&gt; is a method defined in the &lt;em&gt;singleton class&lt;/em&gt; of an object.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As we saw in the &lt;a href=&quot;/posts/understanding-the-singleton-class&quot;&gt;previous post&lt;/a&gt;, class methods are simply &lt;em&gt;singleton methods&lt;/em&gt; of a class object, which explains why the same syntaxes can be used with a different receiver: they do &lt;em&gt;the same thing&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;adding-mixins-to-the-singleton-class&quot;&gt;Adding Mixins to the Singleton Class&lt;/h3&gt;

&lt;p&gt;We are not limited to adding or overriding methods, we can also work with modules.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Greeting&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;introduce&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;Hey, I'm &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;NiceGreeting&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;introduce&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, nice to meet you!&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Greeting&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NiceGreeting&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;introduce&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Hey, I'm Alice, nice to meet you!&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ancestors&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; [#&amp;lt;Class:#&amp;lt;Object:...&amp;gt;&amp;gt;, NiceGreeting, Greeting, ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The example above illustrates how &lt;a href=&quot;/posts/understanding-the-singleton-class/#the-metaclass-hierarchy&quot;&gt;module inheritance&lt;/a&gt; works when dealing with the &lt;em&gt;singleton class&lt;/em&gt;. Using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;extend&lt;/code&gt; is like &lt;em&gt;including&lt;/em&gt; a module in the &lt;em&gt;singleton class&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;extend&lt;/code&gt; on an object will make the module methods available on &lt;em&gt;that&lt;/em&gt; object. In a class definition the object is implicit: &lt;em&gt;the &lt;a href=&quot;/posts/understanding-the-singleton-class/#the-metaclass-of-a-class&quot;&gt;class object&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;practical-applications&quot;&gt;Practical Applications&lt;/h2&gt;

&lt;p&gt;Letâ€™s now dive into a few scenarios where all of this flexibility becomes useful.&lt;/p&gt;

&lt;h3 id=&quot;test-doubles-and-method-stubbing&quot;&gt;Test Doubles and Method Stubbing&lt;/h3&gt;

&lt;p&gt;A &lt;em&gt;test double&lt;/em&gt; is any object that stands in for a real object during a test. &lt;a href=&quot;https://github.com/rspec/rspec-mocks&quot;&gt;Some libraries&lt;/a&gt; allow to easily create doubles, and stub some of their methods:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instance_double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Book'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;pages: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;236&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pages&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; 236&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A &lt;em&gt;method stub&lt;/em&gt; is an instruction to an object to return a known value in response to a message:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;allow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;receive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Free Play'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Free Play&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;Most libraries implement both of these features by leveraging the &lt;em&gt;singleton class&lt;/em&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Letâ€™s see how we might be able to implement a very simplistic version of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;double&lt;/code&gt;, which returns an object that can respond to the specified methods:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method_stubs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_variable_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'@name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;method_stubs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_singleton_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Book'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;pages: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;236&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;title: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Free Play'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pages&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; 236&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Free Play&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By using &lt;a href=&quot;https://ruby-doc.org/core-2.7.2/Object.html#method-i-define_singleton_method&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;define_singleton_method&lt;/code&gt;&lt;/a&gt; we can create a test double that conforms to the provided options, without having to use temporary classes or structs, nor affecting other object instances.&lt;/p&gt;

&lt;h3 id=&quot;rspec-example-group-methods&quot;&gt;RSpec Example Group Methods&lt;/h3&gt;

&lt;p&gt;When writing tests with RSpec, itâ€™s a good practice to keep helpers and state as local as possible. A typical way to do that is to include helpers only for certain types of tests.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EmailSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Helpers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;type: :controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Behind the scenes, RSpec will leverage the &lt;em&gt;singleton class&lt;/em&gt; of a specific example group to include the module, without affecting other test scenarios.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;type: :controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;example_group_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EmailSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Helpers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can use this to our advantage as a way to define scenario-specific methods as well:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;example_group_instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_singleton_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;instance_exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;feature&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Visiting a page'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sign_in_as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'can visit the page as a user'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;as: &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'can visit the page as an admin'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;as: &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Admin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;a href=&quot;https://github.com/ElMassimo/capybara_test_helpers/blob/367fdb898f9c02059dc54f2351a3a46f72cffac8/lib/capybara_test_helpers/rspec.rb#L24&quot;&gt;this example&lt;/a&gt; in the &lt;a href=&quot;https://github.com/ElMassimo/capybara_test_helpers&quot;&gt;&lt;em&gt;Capybara Test Helpers&lt;/em&gt;&lt;/a&gt; library, which uses it to &lt;a href=&quot;https://capybara-test-helpers.netlify.app/guide/essentials/injection.html#test-helpers-in-rspec&quot;&gt;inject test helpers&lt;/a&gt; using a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:test_helpers&lt;/code&gt; option.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;feature&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Cities'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;scenario&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'adding a city'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;test_helpers: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:cities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;visit_page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:cities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Minneapolis'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;have_city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Minneapolis'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;custom-cache-keys&quot;&gt;Custom Cache Keys&lt;/h3&gt;

&lt;p&gt;When using Railsâ€™ cache, &lt;a href=&quot;https://github.com/rails/rails/blob/fe76a95b0d252a2d7c25e69498b720c96b243ea2/activesupport/lib/active_support/cache.rb#L435-L445&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fetch_multi&lt;/code&gt;&lt;/a&gt; supports passing a list of keys, which will be yielded to the block in order to calculate the value to cache.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;keys&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cache_key_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch_multi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What if we need the item instead of the key in order to calculte the value to cache?&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;items_by_cache_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;index_by&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cache_key_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cache_keys&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;items_by_cache_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;keys&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch_multi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cache_keys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;items_by_cache_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Quite awkward. However, &lt;a href=&quot;https://github.com/rails/rails/blob/fe76a95b0d252a2d7c25e69498b720c96b243ea2/activesupport/lib/active_support/cache.rb#L435-L445&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fetch_multi&lt;/code&gt;&lt;/a&gt; also supports passing a list of objects, in which case it will call &lt;a href=&quot;https://github.com/rails/rails/blob/fe76a95b0d252a2d7c25e69498b720c96b243ea2/activesupport/lib/active_support/cache.rb#L649-L653&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cache_key&lt;/code&gt;&lt;/a&gt; on the objects to &lt;a href=&quot;https://github.com/rails/rails/blob/fe76a95b0d252a2d7c25e69498b720c96b243ea2/activesupport/lib/active_support/cache.rb#L649-L653&quot;&gt;obtain the cache keys&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch_multi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But what if the items donâ€™t respond to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cache_key&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;We can leverage &lt;a href=&quot;https://ruby-doc.org/core-2.7.2/Object.html#method-i-define_singleton_method&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;define_singleton_method&lt;/code&gt;&lt;/a&gt; to define it differently for each item:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_singleton_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:cache_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cache_key_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch_multi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;a href=&quot;https://github.com/ElMassimo/oj_serializers/blob/385aea5d97c477be9ff121edd622974a861877af/lib/oj_serializers/serializer.rb#L269&quot;&gt;this example&lt;/a&gt; in the &lt;a href=&quot;https://github.com/ElMassimo/oj_serializers&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;oj_serializers&lt;/code&gt;&lt;/a&gt; library, which &lt;a href=&quot;https://github.com/ElMassimo/oj_serializers/blob/385aea5d97c477be9ff121edd622974a861877af/lib/oj_serializers/serializer.rb#L262&quot;&gt;defines&lt;/a&gt; a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cache_key&lt;/code&gt; &lt;em&gt;singleton method&lt;/em&gt; for each object, so that they can be passed to &lt;a href=&quot;https://github.com/rails/rails/blob/fe76a95b0d252a2d7c25e69498b720c96b243ea2/activesupport/lib/active_support/cache.rb#L649-L653&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fetch_multi&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;ad-hoc-validations-in-rails&quot;&gt;Ad Hoc Validations in Rails&lt;/h2&gt;

&lt;p&gt;Letâ€™s imagine that we have a file upload API, and we are running an integrity check on save.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;FileIntegrityValidation&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;extend&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Concern&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;included&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;validate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'is corrupt'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;corrupt?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;corrupt?&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What if we need to run the validation conditionally based on a setting that is not accesible from the model?&lt;/p&gt;

&lt;p&gt;We can leverage the &lt;em&gt;singleton class&lt;/em&gt; to define the validation conditionally:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Api::FilesController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Api&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;BaseController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:file_upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;file_upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FileIntegrityValidation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;check_file_integrity?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file_upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;The &lt;a href=&quot;https://github.com/ElMassimo/resourcerer&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resource&lt;/code&gt;&lt;/a&gt; syntax is coming from &lt;a href=&quot;https://github.com/ElMassimo/resourcerer&quot;&gt;&lt;em&gt;resourcerer&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In this case we canâ€™t use &lt;a href=&quot;#adding-mixins-to-the-singleton-class&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;extend&lt;/code&gt;&lt;/a&gt; because &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActiveSupport::Concern&lt;/code&gt; internally uses the &lt;a href=&quot;https://ruby-doc.org/core-2.7.2/Module.html#method-i-included&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;included&lt;/code&gt;&lt;/a&gt; hook, which is only triggered when using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;include&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;When using this pattern, itâ€™s better to encapsulate it so that itâ€™s easier to understand:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;FileIntegrityValidation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;apply_on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;check_file_integrity?&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;FileIntegrityValidation&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Public: Define this validation only for the provided object.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;apply_on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;We can use an objectâ€™s &lt;em&gt;singleton class&lt;/em&gt; to define methods or include modules without affecting other instances, which enables very powerful techniques such as method stubbing and dynamically modifying behavior.&lt;/p&gt;

&lt;p&gt;In practice, the use cases where this is necessary donâ€™t come around very often. Itâ€™s usually possible to achieve what we need using simpler or more explicit strategies, that are easier to reason about.&lt;/p&gt;

&lt;p&gt;As with most advanced techniques, you will know when you need it ðŸ˜ƒ&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/practical-applications-of-the-singleton-class.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="ruby" />
  
    <category term="language" />
  
  
    <summary>The _singleton class_ is rarely used in practice to modify the behavior of specific objects. Read on to learn a few practical applications that might prove useful in your code.</summary>
  
  </entry>

  <entry>
    <title>What is the Singleton Class in Ruby?</title>
    <link href="http://maximomussini.com/posts/understanding-the-singleton-class/" rel="alternate" type="text/html" title="What is the Singleton Class in Ruby?" />
    <published>2020-12-04T00:00:00-03:00</published>
  
    <updated>2020-12-04T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/understanding-the-singleton-class</id>
    <content type="html" xml:base="http://maximomussini.com/posts/understanding-the-singleton-class/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/understanding-the-singleton-class.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;The &lt;em&gt;singleton class&lt;/em&gt;, also referred to as the &lt;em&gt;metaclass&lt;/em&gt; or the &lt;em&gt;eigenclass&lt;/em&gt;. What is it exactly?&lt;/p&gt;

&lt;p&gt;Letâ€™s begin by discussing the &lt;strong&gt;main purpose&lt;/strong&gt; of metaclasses in Ruby.&lt;/p&gt;

&lt;h2 id=&quot;classes-and-method-dispatching&quot;&gt;Classes and Method Dispatching&lt;/h2&gt;

&lt;p&gt;In Ruby, everything is an &lt;em&gt;object&lt;/em&gt;, and every object has a &lt;em&gt;class&lt;/em&gt;, which defines the &lt;em&gt;methods&lt;/em&gt; the object can respond to.&lt;/p&gt;

&lt;p&gt;These two statements also apply to classes, which is what makes it possible for classes in Ruby to have their own instance variables and to receive methods.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Animal&lt;/span&gt;
  &lt;span class=&quot;vi&quot;&gt;@description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'A multicellular eukaryotic organism.'&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;description&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@description&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;A multicellular eukaryotic organism.&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In contrast with other languages, in Ruby what we usually refer to as &lt;em&gt;class methods&lt;/em&gt; are simply &lt;em&gt;instance methods&lt;/em&gt; of a class object.&lt;/p&gt;

&lt;p&gt;Now, if a class in Ruby is an object, and every object has a class which defines its methods, then a class in Ruby &lt;em&gt;has a class which defines its methods&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; Class&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Class&lt;/code&gt; defined those methods, then they would be available for any class object.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# NoMethodError (undefined method `description' for Integer:Class)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How does Ruby pull it off then?&lt;/p&gt;

&lt;h2 id=&quot;the-metaclass-of-a-class&quot;&gt;The Metaclass of a Class&lt;/h2&gt;

&lt;p&gt;Ruby deals with it by giving every &lt;em&gt;object&lt;/em&gt; its own unique class, which defines the methods available for that object. Its very own &lt;em&gt;&lt;strong&gt;metaclass&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The metaclass is called the &lt;a href=&quot;https://en.wikipedia.org/wiki/Singleton_pattern&quot;&gt;&lt;em&gt;singleton class&lt;/em&gt;&lt;/a&gt; because there is &lt;em&gt;one single instance&lt;/em&gt; of it.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; #&amp;lt;Class:Animal&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This class is hidden in the inheritance chain (it doesnâ€™t show up when calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ancestors&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;class&lt;/code&gt; returns &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Class&lt;/code&gt;), but we can think of it as &lt;em&gt;&lt;strong&gt;the first ancestor&lt;/strong&gt;&lt;/em&gt; when it comes to dispatching methods.&lt;/p&gt;

&lt;p&gt;When calling a method on an object, Ruby will perform the method lookup by first checking on the objectâ€™s &lt;em&gt;metaclass&lt;/em&gt;, before traversing the rest of the method chain.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_methods&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; [:description]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just like instance methods are defined in a class, class methods are defined in the &lt;em&gt;metaclass&lt;/em&gt; of a class object.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This design enables Ruby to share the same dispatch mechanism for class methods: &lt;em&gt;&lt;strong&gt;internally all methods are instance methods&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;the-metaclass-hierarchy&quot;&gt;The Metaclass Hierarchy&lt;/h2&gt;

&lt;p&gt;In the diagram below we can see that each class has a corresponding &lt;em&gt;metaclass&lt;/em&gt;, which is where their respective &lt;em&gt;class methods&lt;/em&gt; are defined.&lt;/p&gt;

&lt;picture&gt;
  &lt;source srcset=&quot;/images/posts/understanding-the-singleton-class/the-metaclass-hierarchy.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot; /&gt;
  &lt;source srcset=&quot;/images/posts/understanding-the-singleton-class/the-metaclass-hierarchy-500.webp&quot; type=&quot;image/webp&quot; /&gt;
  &lt;img src=&quot;/images/posts/understanding-the-singleton-class/the-metaclass-hierarchy.jpg&quot; alt=&quot;Diagram of the Metaclass Hierarchy&quot; class=&quot;&quot; /&gt;
&lt;/picture&gt;

&lt;blockquote&gt;
  &lt;p&gt;The inheritance chain of metaclasses is what allows to inherit and override class methods and call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;super&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;And that is the main purpose of metaclasses in Ruby.&lt;/p&gt;

&lt;h2 id=&quot;the-metaclass-of-an-object&quot;&gt;The Metaclass of an Object&lt;/h2&gt;

&lt;p&gt;Notice how the instance also has its own metaclass: &lt;em&gt;classes are just a particular kind of object&lt;/em&gt;. When we call a method on an instance, Ruby will also look in its metaclass first.&lt;/p&gt;

&lt;p&gt;Letâ€™s see a few examples of how we can use the metaclass to define methods that are specific to a particular instance.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;other_animal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bark&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;'Woof'&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;greet&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;'hi'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;define_singleton_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:roar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Rawr!'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bark&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Woof&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;greet&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Hi&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;roar&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; &quot;Rawr!&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_methods&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; [:bark, :roar, :greet]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; [:bark, :roar, :greet]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;other_animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;bark&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# NoMethodError (undefined method `bark' for #&amp;lt;Animal&amp;gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;other_animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;singleton_methods&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# =&amp;gt; []&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You will certainly recognize the first two patterns, they use the same syntax that is typically used with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;self&lt;/code&gt; to define &lt;em&gt;class methods&lt;/em&gt;!&lt;/p&gt;

&lt;p&gt;Once again, &lt;em&gt;classes are just a particular kind of object&lt;/em&gt;. And yet, unlike classes, modifying the behavior of a particular object is rarely used in practice.&lt;/p&gt;

&lt;p&gt;In the &lt;em&gt;&lt;a href=&quot;/posts/practical-applications-of-the-singleton-class&quot;&gt;next post&lt;/a&gt;&lt;/em&gt; I share a few useful applications of this feature, &lt;a href=&quot;/posts/practical-applications-of-the-singleton-class&quot;&gt;read on&lt;/a&gt;!&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/understanding-the-singleton-class.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="ruby" />
  
    <category term="language" />
  
  
    <summary>The _singleton class_, also referred to as the _metaclass_ or the _eigenclass_. What is it exactly?
In this post we dive into Ruby's internals to demistify this aspect of the language.</summary>
  
  </entry>

  <entry>
    <title>Generating a JS API from Rails Routes</title>
    <link href="http://maximomussini.com/posts/js-from-routes/" rel="alternate" type="text/html" title="Generating a JS API from Rails Routes" />
    <published>2020-06-22T00:00:00-03:00</published>
  
    <updated>2020-06-22T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/js-from-routes</id>
    <content type="html" xml:base="http://maximomussini.com/posts/js-from-routes/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/js-from-routes.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;One idea Iâ€™ve always appreciated about the routing approach in Rails is &lt;strong&gt;path helpers&lt;/strong&gt;, which are automatically generated from route definitions.&lt;/p&gt;

&lt;p&gt;Some advantages of using path helpers are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Thereâ€™s no need to take care of manually interpolating ids and parameters to
build a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;String&lt;/code&gt; URL.&lt;/li&gt;
  &lt;li&gt;Any change to the route definition affects the helper, so if a route is
removed or modified, the path helper is no longer available.&lt;/li&gt;
  &lt;li&gt;Code that uses an outdated path helper causes a runtime error, which can be
detected by integration or unit tests, instead of rendering a path that would
end up in a 404, like it would happen when using manual string interpolation.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;path-helpers-in-js&quot;&gt;Path Helpers in JS&lt;/h2&gt;
&lt;p&gt;Traditionally, frontend code in Rails replicates the path structure as defined in the backend, hardcoding the paths for every endpoint that needs to be accessed, and specifying HTTP verbs as needed (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GET&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATCH&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/search&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This approach is very cumbersome, and it is possible to introduce typos, or
make mistakes like choosing the wrong HTTP verb (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PUT&lt;/code&gt; instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATCH&lt;/code&gt;, and so on).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;We could avoid these problems if we had path helpers in JS.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;While some tools that allowed to expose path helpers to JS already existed, they were created when &lt;a href=&quot;https://github.com/rails/sprockets&quot;&gt;sprockets&lt;/a&gt; was &lt;em&gt;the&lt;/em&gt; way to compile frontend assets in Rails, long before the &lt;a href=&quot;https://github.com/rails/webpacker&quot;&gt;Webpack&lt;/a&gt; era.&lt;/p&gt;

&lt;p&gt;I wanted a solution that provided an enjoyable front-end development experience. One that could leverage Webpack loaders and aliases, and was based on ES6 modules to allow tree-shaking, was easy to inspect, and where changes could be tracked under version control.&lt;/p&gt;

&lt;p&gt;And thatâ€™s why I created &lt;a href=&quot;https://github.com/ElMassimo/js_from_routes&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JsFromRoutes&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;shaping-the-vision-&quot;&gt;Shaping the Vision âœ¨&lt;/h3&gt;
&lt;p&gt;From a developerâ€™s UX perspective, the goal was to simplify how to make &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API&quot;&gt;requests&lt;/a&gt; to a Rails API.&lt;/p&gt;

&lt;p&gt;This meant not thinking about paths, parameter interpolation, nor HTTP verbs. Just plain function calls and promises.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UsersRequests&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;@requests/UsersRequests&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;UsersRequests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These functions would be automatically generated from the Rails route definitions. The generation process should be transparent, and happen automatically as routes are added and the application is reloaded.&lt;/p&gt;

&lt;p&gt;For maintainability, as well as for tree-shaking purposes, it was desirable to do a simple mapping: &lt;em&gt;one request object per controller&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;@services/ApiService&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/users/search&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/users&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/users/:id&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Delegating the actual request to an existing service would allow to keep the generated code lean. Any changes or improvements could then be made on the service itself, without having to regenerate the code. For example, switching from &lt;a href=&quot;https://github.com/axios/axios&quot;&gt;axios&lt;/a&gt; to &lt;a href=&quot;https://github.com/developit/redaxios&quot;&gt;redaxios&lt;/a&gt;, or to the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API&quot;&gt;fetch API&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;generating-js-from-rails-routes-ï¸&quot;&gt;Generating JS from Rails Routes âš™ï¸&lt;/h3&gt;

&lt;p&gt;Although the routes DSL in Rails wasnâ€™t designed for inspection purposes, it does provide
the necessary metadata: the name of the endpoints, the HTTP verbs, and the paths including named parameters.&lt;/p&gt;

&lt;p&gt;By doing some slight processing to the information in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rails.application.routes&lt;/code&gt;, and combining that with an ERB template, we are able to generate the JS functions we need.&lt;/p&gt;

&lt;div class=&quot;language-erb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import { request } from '@services/ApiService'

export default {
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each_with_index&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;helper&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;: options =&amp;gt;
    request('&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;verb&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;', '&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;', options),
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;automating-the-flow-&quot;&gt;Automating the Flow ðŸ¤–&lt;/h3&gt;
&lt;p&gt;Why trigger the generation manually? Let the machines do it ðŸ˜ƒ&lt;/p&gt;

&lt;p&gt;By adding a hook to Railsâ€™ reload process in development, we can automatically
generate files from routes when a route is added, modified, or removed.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Reloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_prepare&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JsFromRoutes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;generate!&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In order to optimize file generation, we split the generated JS files by
controller, and add a cache key based on the routes to avoid rewriting the file
if the route definition hasnâ€™t changed.&lt;/p&gt;

&lt;p&gt;When the Webpack development server is running, this automatically triggers a
new build, and our request method or path helper is ready to be used!&lt;/p&gt;

&lt;h3 id=&quot;the-gem-&quot;&gt;The Gem ðŸ’Ž&lt;/h3&gt;

&lt;p&gt;The flow described above is now available through the &lt;a href=&quot;https://github.com/ElMassimo/js_from_routes&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;js_from_routes&lt;/code&gt;&lt;/a&gt; gem. The library provides additional configuration options, &lt;a href=&quot;https://github.com/ElMassimo/js_from_routes&quot;&gt;visit the readme&lt;/a&gt; for more information.&lt;/p&gt;

&lt;p&gt;This approach has similar benefits to path helpers in Rails:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;No need to manually specify the URL, preventing mistakes and saving development time.&lt;/li&gt;
  &lt;li&gt;If an action is renamed or removed, the helper ceases to exist, which causes an error that is easier to detect than a 404.&lt;/li&gt;
  &lt;li&gt;The HTTP verb is embedded in the helper, so itâ€™s transparent for the client code. Changing the verb in the route causes the JS code to be regenerated, no need to update the consumers!&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ElMassimo/js_from_routes&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;js_from_routes&lt;/code&gt;&lt;/a&gt; allows to automatically generate path and API helpers from Rails route definitions, allowing you to save development effort and focus on the things that matter.&lt;/p&gt;

&lt;p&gt;Since introducing this tool, we have saved a lot of time that we would have
spent writing boilerplate code, avoided a lot of mistakes like typos and
interpolation errors, and made the front-end development experience more
enjoyable ðŸ˜ƒ&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/js-from-routes.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="rails" />
  
    <category term="http" />
  
    <category term="ajax" />
  
    <category term="api" />
  
    <category term="js" />
  
  
  </entry>

  <entry>
    <title>Store Objects for Vuex</title>
    <link href="http://maximomussini.com/posts/vuex-stores/" rel="alternate" type="text/html" title="Store Objects for Vuex" />
    <published>2020-05-12T00:20:00-03:00</published>
  
    <updated>2020-05-12T00:20:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/vuex-stores</id>
    <content type="html" xml:base="http://maximomussini.com/posts/vuex-stores/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/vuex-stores.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;&lt;a href=&quot;https://vuex.vuejs.org/&quot;&gt;Vuex&lt;/a&gt; is a state-management solution that integrates nicely with
&lt;a href=&quot;https://vuejs.org/&quot;&gt;Vue&lt;/a&gt; components.&lt;/p&gt;

&lt;p&gt;When starting to use Vuex, one quickly realizes that itâ€™s easier to manage and
understand the state of a large application when the state is split between
different &lt;a href=&quot;https://vuex.vuejs.org/guide/modules.html&quot;&gt;modules in the Vuex store&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Unfortunately, working with modules involves using a &lt;em&gt;namespace string&lt;/em&gt; to
access state and getters, which makes typos hard to detect, and can
quickly become cumbersome if using &lt;a href=&quot;https://vuex.vuejs.org/guide/mutations.html#using-constants-for-mutation-types&quot;&gt;constants&lt;/a&gt; or a similar
approach to avoid duplication.&lt;/p&gt;

&lt;p&gt;Another weak spot is that dispatching actions feels very unnatural, and also
requires specifying the &lt;em&gt;namespace string&lt;/em&gt; as a prefix for the action name.&lt;/p&gt;

&lt;h2 id=&quot;a-smoother-experience-&quot;&gt;A smoother experience ðŸ¥ƒ&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&quot;https://github.com/ElMassimo/vuex-stores&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuex-stores&lt;/code&gt;&lt;/a&gt; library helps you avoid these shortcomings
by providing light wrappers around individual &lt;a href=&quot;https://vuex.vuejs.org/guide/modules.html&quot;&gt;Vuex store modules&lt;/a&gt;,
which Iâ€™ve dubbed &lt;em&gt;â€œstore-objectsâ€&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Store objects&lt;/em&gt; address these issues by allowing access to state and getters as
properties, and dispatching actions easily by using plain method calls.&lt;/p&gt;

&lt;p&gt;As a result, itâ€™s possible to leverage all the goodness in Vuex, using an
&lt;a href=&quot;https://github.com/ElMassimo/vuex-stores#api-%EF%B8%8F&quot;&gt;elegant and convenient API&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conventions-&quot;&gt;Conventions ðŸ”¤&lt;/h2&gt;

&lt;p&gt;In order to organize these store objects, an approach that works nicely is to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Create one file per store module under a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stores&lt;/code&gt; directory.&lt;/li&gt;
  &lt;li&gt;Always use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Store&lt;/code&gt; as a suffix for the file name (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ModalsStore&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;Add a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@stores&lt;/code&gt; webpack alias to make them convenient to import.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Letâ€™s take a look at an example usage:&lt;/p&gt;

&lt;div class=&quot;language-vue highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ModalsStore&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;@stores/ModalsStore&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;ModalManager&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;computed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// `mapState` and friends are available to inject state or getters into the&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// template, without the need to specify the namespace string.&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ModalsStore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mapState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;modals&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;beforeMount&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// closeAllModals is an action, and it will be dispatched every time the&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// route changes, to hide any open modals.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;afterEach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ModalsStore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;closeAllModals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Actions are available as methods, notice the lack of boilerplate to&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// inject it in the component using `mapActions`.&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;onModalClose&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;modal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;ModalsStore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;removeModal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;modal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// NOTE: A shorter version would be: `onModalClose: ModalsStore.removeModal,`&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;modal-manager&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;component&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;:is=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;modal.component&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;v-for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;modal in modals&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;:key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;modal.id&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;v-bind=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;modal.attrs&quot;&lt;/span&gt;
      &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;modal:close=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;onModalClose(modal)&quot;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As seen in this short example, state, getters, and actions can be easily injected
in a component using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;map&lt;/code&gt; helpers to make them available in the template.&lt;/p&gt;

&lt;p&gt;Actions can be dispatched by simply calling a method, which is closer to how
they are defined, and feels very natural. Typos in action names are prevented,
since a method call would fail if the name is not correct (instead of being ignored)&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;namespace string&lt;/em&gt; becomes an implementation detail which is transparent to
the user, without having to use cumbersome manual techniques (such as &lt;a href=&quot;https://vuex.vuejs.org/guide/mutations.html#using-constants-for-mutation-types&quot;&gt;constants&lt;/a&gt;)
to avoid duplicating the module name all over the codebase.&lt;/p&gt;

&lt;p&gt;Because incorrect ES6 imports provide clear errors, typos in the store name can
be detected at compile time, and refactoring becomes a lot easier (usually as
simple as &lt;em&gt;search and replace&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;There are more code samples available in the &lt;a href=&quot;https://github.com/ElMassimo/vuex-stores#api-%EF%B8%8F&quot;&gt;documentation&lt;/a&gt; ðŸ“–&lt;/p&gt;

&lt;h2 id=&quot;code-splitting-ï¸&quot;&gt;Code Splitting âœ‚ï¸&lt;/h2&gt;

&lt;p&gt;Store modules in Vuex can be &lt;a href=&quot;https://vuex.vuejs.org/guide/modules.html#dynamic-module-registration&quot;&gt;registered dynamically&lt;/a&gt;,
so internally &lt;a href=&quot;https://github.com/ElMassimo/vuex-stores&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuex-stores&lt;/code&gt;&lt;/a&gt; leverages &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;registerModule&lt;/code&gt; to
add a new module when the store object is imported.&lt;/p&gt;

&lt;p&gt;This means that store objects donâ€™t need to be imported up-front when initially
defining the Vuex store, playing nicely with apps that do code splitting, since
the code associated to a store object will only be loaded if needed.&lt;/p&gt;

&lt;p&gt;As a result, the initial setup of the Vuex store will be lighter, and by
using the conventions described above, code loading and execution will be
optimized.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ElMassimo/vuex-stores&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuex-stores&lt;/code&gt;&lt;/a&gt; provides a simple way to work with &lt;a href=&quot;https://vuex.vuejs.org/guide/modules.html&quot;&gt;Vuex modules&lt;/a&gt;
by allowing you to define &lt;em&gt;store objects&lt;/em&gt; to focus on one module at a time,
making it more enjoyable to leverage Vuex.&lt;/p&gt;

&lt;p&gt;The API is convenient and easy to learn, prevents mistakes such as typos, and
works nicely when used in conjunction with ES6 modules, making the code easier
to reason about and refactor.&lt;/p&gt;

&lt;p&gt;Also, itâ€™s a lot of fun, give it a try! ðŸ˜ƒ&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/vuex-stores.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="js" />
  
    <category term="vue" />
  
    <category term="vuex" />
  
    <category term="state" />
  
  
    <summary>It's easier to manage and understand state in Vuex when it is split between different modules. However, the default approach has some shortcomings that make modules cumbersome to use.

Read on to find out how to leverage all the goodness in Vuex using a more natural and convenient API, making your app easier to reason about and refactor.</summary>
  
  </entry>

  <entry>
    <title>Documentation is a Great Investment</title>
    <link href="http://maximomussini.com/posts/documentation-is-a-great-investment/" rel="alternate" type="text/html" title="Documentation is a Great Investment" />
    <published>2020-02-17T00:00:00-03:00</published>
  
    <updated>2020-02-17T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/documentation-is-a-great-investment</id>
    <content type="html" xml:base="http://maximomussini.com/posts/documentation-is-a-great-investment/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/documentation-is-a-great-investment.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;In this post Iâ€™d like to share a practice that has completely changed the way we
work: documentation as a first-class citizen in our software development process.&lt;/p&gt;

&lt;p&gt;Documentation facilitates understanding, which is &lt;em&gt;vital&lt;/em&gt; to enable
change and continuous improvement.&lt;/p&gt;

&lt;h2 id=&quot;how-is-it-helpful-thinking&quot;&gt;How is it helpful? :thinking:&lt;/h2&gt;

&lt;p&gt;Traditionally, we aim to produce clean and maintainable code to make it more
reliable, and write tests to protect it. We use good variable names, split
functions that perform too much into simpler ones, and design them so that
parameter names convey enough information.&lt;/p&gt;

&lt;p&gt;However, seeing &lt;em&gt;what&lt;/em&gt; the code does is not the same as figuring out &lt;em&gt;why&lt;/em&gt; it does it.&lt;/p&gt;

&lt;p&gt;Most of the design process happens informally in chat rooms, conversations, and
online documents. As a result, understanding a decision that was made a long time
ago can be very time consuming, as it requires scanning through chat messages,
and reaching out to the people that were involved.&lt;/p&gt;

&lt;p&gt;When we are not able to obtain enough information about these decisions, it
becomes harder to effectively reason about the software, slowing down fixes and
improvements.&lt;/p&gt;

&lt;p&gt;This is why learning about past decisions should be as efficient and
straightforward as possible: it will save us a lot of time and frustration down
the line. Knowing the context will allow us to make informed decisions,
which are &lt;em&gt;better&lt;/em&gt; decisions.&lt;/p&gt;

&lt;h2 id=&quot;best-time-to-start-was-years-ago-second-best-time-is-now-hourglass&quot;&gt;Best time to start was years ago, second best time is now :hourglass:&lt;/h2&gt;

&lt;p&gt;If we are to make our software easier to understand, and thus easier to change,
we should &lt;strong&gt;&lt;em&gt;document our intent&lt;/em&gt;&lt;/strong&gt; in every possible way. Think about it as a
byproduct of the thought process we carry out as developers when designing a
solution and writing code.&lt;/p&gt;

&lt;p&gt;Capture any breadcrumbs that might be useful in the future to find out how
things are supposed to work, helping other developers unravel the conditions
and mindset that influenced the code, even when we no longer remember why.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Document as you go&lt;/em&gt;&lt;/strong&gt;. No other time will be better to document than when the
ideas are fresh in our mind. Memories fade over time, and what we fail to
record then might be hopeless or painfully time-consuming to remember later.&lt;/p&gt;

&lt;p&gt;The overhead of documenting on the spot is negligible, but the overall benefits
are certainly not!&lt;/p&gt;

&lt;h2 id=&quot;documenting-is-intrinsically-a-valuable-activity-moneybag&quot;&gt;Documenting is intrinsically a valuable activity :moneybag:&lt;/h2&gt;

&lt;p&gt;To get the best out of it, we should imagine we are someone else trying to
understand our work. Which things will not be so obvious a few months from now?
Thinking about it can help to reveal our underlying assumptions and knowledge.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Is it clear how this component interacts with other parts of the system?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;By doing this mental exercise, we will be able to find simpler and more readable
ways to solve a problem, allowing us to refine our designs and solutions.
It has a direct positive impact in maintainability, regardless of whether
someone actually reads the resulting documentation.&lt;/p&gt;

&lt;p&gt;Our focus should be on recording intent, &lt;em&gt;why&lt;/em&gt; and &lt;em&gt;how&lt;/em&gt; things &lt;em&gt;should&lt;/em&gt; happen.
Itâ€™s also useful to cross-reference classes and objects that interact with each
other. Aim for the bigger picture, and work your way down as needed.&lt;/p&gt;

&lt;h2 id=&quot;a-lightweight-approach-is-good-enough-zap&quot;&gt;A lightweight approach is good enough :zap:&lt;/h2&gt;

&lt;p&gt;In practice, weâ€™ve found that using a conventional but minimal
&lt;a href=&quot;https://gist.github.com/ElMassimo/a118d08482d9db8e71d622e136f10155#which-format-to-use&quot;&gt;syntax&lt;/a&gt; for comments works well, and that itâ€™s better to
&lt;a href=&quot;https://gist.github.com/ElMassimo/a118d08482d9db8e71d622e136f10155&quot;&gt;&lt;em&gt;&lt;strong&gt;inline documentation&lt;/strong&gt;&lt;/em&gt;&lt;/a&gt; in the code itself.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Public: Abbreviation of a few words that sums up what the question is about.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Example: 'Side Effects'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;type: &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;String&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inline docs are always at hand, require very low effort to add and update, and
are very helpful for developers to gain insight (both during reviews and in the long run).&lt;/p&gt;

&lt;p&gt;They should be clear and concise. Donâ€™t overstate the obvious and remove any
words that feel unnecessary. &lt;em&gt;&lt;strong&gt;Creating good documentation takes practice&lt;/strong&gt;&lt;/em&gt;,
itâ€™s more about writing skills and less about programming.&lt;/p&gt;

&lt;p&gt;While itâ€™s possible to generate documentation pages from a &lt;a href=&quot;https://gist.github.com/ElMassimo/a118d08482d9db8e71d622e136f10155#which-format-to-use&quot;&gt;minimal syntax&lt;/a&gt;,
usually navigating through the source code and reading the inline docs is more
convenient. Using &lt;em&gt;Goto Symbol&lt;/em&gt; or &lt;em&gt;Goto Definition&lt;/em&gt; on any &lt;a href=&quot;https://www.sublimetext.com/&quot;&gt;editor&lt;/a&gt; does the trick.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Wonâ€™t the comments become outdated really quickly? :scream_cat:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;version-control-to-the-rescue-&quot;&gt;Version control to the rescue! ðŸ¦¸&lt;/h2&gt;

&lt;p&gt;More often than not, the core concepts in the software we write rarely change,
so the documentation tends to be useful even when not entirely accurate.&lt;/p&gt;

&lt;p&gt;Combined with &lt;a href=&quot;https://git-scm.com/&quot;&gt;source control&lt;/a&gt;, even when the comments are
outdated, the original intention is never lost. We can navigate back through
history and get the full context in which the documentation was written.&lt;/p&gt;

&lt;p&gt;In the same way we should document our intent in methods, properties, and classes,
itâ€™s also important to capture the broader purpose of changes in commits. This
will enable us to &lt;a href=&quot;https://git-scm.com/docs/git-blame&quot;&gt;look back to learn more&lt;/a&gt;, saving us an
invaluable amount of time when trying to understand past decisions.&lt;/p&gt;

&lt;p&gt;As a result, we can move forward with deeper undestanding and confidence,
refactoring or removing code without fear of accidentally breaking the app, or
going against an otherwise long-forgotten decision.&lt;/p&gt;

&lt;h2 id=&quot;pull-requests-as-the-unit-of-change-&quot;&gt;Pull Requests as the unit of change ðŸ§©&lt;/h2&gt;

&lt;p&gt;Usually in a team environment, the &lt;em&gt;pull request&lt;/em&gt; replaces the &lt;em&gt;commit&lt;/em&gt; as the &lt;em&gt;unit
of change&lt;/em&gt;. Besides providing a platform for code review, pull requests are
great for adding rich non-text information, such as images and video, and
hyperlinks to external resources.&lt;/p&gt;

&lt;p&gt;As a result, they also have an immense potential for communication and
documentation. We should leverage the description to explain substantial changes
(&lt;em&gt;why&lt;/em&gt; and &lt;em&gt;what for&lt;/em&gt;), provide screenshots, and any content that makes it
easier to follow the work.&lt;/p&gt;

&lt;p&gt;Doing so will leave a solid trail that can help anyone grasp the full picture
later on, in addition to improving the communication and quality of the reviews.
Two for one!&lt;/p&gt;

&lt;h2 id=&quot;tldr-document-all-the-things-pencil2-book&quot;&gt;TLâ€™DR: Document all the things! :pencil2: :book:&lt;/h2&gt;

&lt;p&gt;Code is read a lot more often than itâ€™s written, which is why inline docs
provide a great return for their tiny cost. Same can be said about writing
a nice pull request description, describing specific decisions in comments,
and providing screenshots.&lt;/p&gt;

&lt;p&gt;Weâ€™ve saved a lot of time when figuring out how things work, enabled our team to
refactor with confidence, prevented problems and regressions, and made entire
areas of the app more approachable for other developers.&lt;/p&gt;

&lt;p&gt;The simple practice of documenting helps junior and senior developers alike, and
after you start using it, youâ€™ll be wondering why you didnâ€™t start sooner :smiley:&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/documentation-is-a-great-investment.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="development" />
  
    <category term="documentation" />
  
    <category term="teamwork" />
  
    <category term="technical_debt" />
  
  
    <summary>Would you like to prevent problems and regressions? Refactor with confidence? Save development time? Make any area of the app accessible to other developers?

Read on to find out how a team that _documents their work_ is on a better path to achieve all the above.</summary>
  
  </entry>

  <entry>
    <title>Ruby Keywords and the Double Splat Operator</title>
    <link href="http://maximomussini.com/posts/ruby-double-splat-keywords/" rel="alternate" type="text/html" title="Ruby Keywords and the Double Splat Operator" />
    <published>2020-01-30T00:00:00-03:00</published>
  
    <updated>2020-01-30T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/ruby-double-splat-keywords</id>
    <content type="html" xml:base="http://maximomussini.com/posts/ruby-double-splat-keywords/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/ruby-double-splat-keywords.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;One of the nicest bits of syntax sugar in Ruby are &lt;em&gt;keywords&lt;/em&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;**&lt;/code&gt; or &lt;em&gt;double-splat&lt;/em&gt;).&lt;/p&gt;

&lt;h2 id=&quot;keywords-in-method-parameters&quot;&gt;Keywords in Method Parameters&lt;/h2&gt;

&lt;p&gt;Just like the splat operator (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*args&lt;/code&gt;) captures any parameters as an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Array&lt;/code&gt; of
arguments, the double-splat operator (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;**attrs&lt;/code&gt;) captures any option parameters
as a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The nice thing is that it allows to destructure a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; argument into any of
its individual keys, and mark it as required, or make it optional and provide a
default value for it.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:middle_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;compact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hi &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;!&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Gale'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Hi Gale!&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'John'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# ArgumentError (missing keyword: first_name)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Bruce'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;middle_name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Wayne'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Keaton'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Hi Bruce Wayne Keaton!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thereâ€™s one &lt;strong&gt;&lt;em&gt;big gotcha&lt;/em&gt;&lt;/strong&gt; which comes up a lot when first learning Ruby:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hi &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;!&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;greet&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Hi !&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;greet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'name'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Jane'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# ArgumentError (wrong number of arguments (given 1, expected 0))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Many developers have scratched their heads wondering whatâ€™s going on, until
they learn the cause of this unintuitive message.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Only &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; keys are allowed in keyword arguments ðŸ˜²&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Ruby handles keyword arguments differently in its internals, which unfortunately
leaks into this error message.&lt;/p&gt;

&lt;h2 id=&quot;merging-hashes-with-the-double-splat-operator&quot;&gt;Merging Hashes with the Double-Splat operator&lt;/h2&gt;

&lt;p&gt;The double-splat operator can also be used to combine hashes. The order matters,
when resolving duplicate keys, the rightmost ones will take priority.&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Jane&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Doe&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Johnson&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# { :first_name =&amp;gt; &quot;Jane&quot;, :last_name =&amp;gt; &quot;Johnson&quot; }&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Johnson&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# { :last_name =&amp;gt; &quot;Doe, :first_name =&amp;gt; &quot;Jane&quot; }&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are a few caveats when combining hashes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It does not combine keys of different types, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;String&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;It can &lt;strong&gt;only&lt;/strong&gt; be used with Hashes where all keys are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt;s.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Jane&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Doe&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;first_name&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;John&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# { :first_name =&amp;gt; &quot;Jane&quot;, :last_name=&amp;gt;&quot;Doe&quot;, &quot;first_name&quot;=&amp;gt;&quot;John&quot; }&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;first_name&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Jane&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;last_name&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Doe&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;doe&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jane&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;John&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TypeError (hash key &quot;first_name&quot; is not a Symbol)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message used to be very cryptic like the one for keyword arguments, but it
has improved a lot since the feature was first added ðŸŽ‰&lt;/p&gt;

&lt;h2 id=&quot;a-quick-note-about-rails&quot;&gt;A quick note about Rails&lt;/h2&gt;

&lt;p&gt;When using Rails a developer might think:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I can obtain values from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;params&lt;/code&gt; using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; keys, but I canâ€™t pass them
as keyword arguments! Thought they were all &lt;em&gt;Symbol&lt;/em&gt; keys?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The short answer is &lt;em&gt;no&lt;/em&gt;. In Rails controllers, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;params&lt;/code&gt; is an instance of &lt;em&gt;HashWithIndiferentAccess&lt;/em&gt;.
You may index it with &lt;em&gt;Symbol&lt;/em&gt; keys but internally it uses &lt;em&gt;String&lt;/em&gt; keys.&lt;/p&gt;

&lt;p&gt;Fortunately, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;symbolize_keys&lt;/code&gt; is our friend here, allowing us to transform any
Hash, such as HTTP parameters, to something we can pass as keyword arguments.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;So there you have it, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;**&lt;/code&gt; is to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; what &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt; is to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Array&lt;/code&gt;, and is a very
convenient tool to write shorter, expressive code.&lt;/p&gt;

&lt;p&gt;Just watch out for errors when using non-&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; keys in keyword arguments,
at least until Ruby improves that error message ðŸ˜‰&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Would you like to &lt;a href=&quot;/posts/ruby-to_proc/&quot;&gt;learn about Rubyâ€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; shortcuts&lt;/a&gt;?&lt;/em&gt;&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/ruby-double-splat-keywords.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="ruby" />
  
    <category term="language" />
  
    <category term="keywords" />
  
  
    <summary>One of the nicest bits of syntax sugar in Ruby are _keywords_.

In this short post we will explore the keyword operator in Ruby, and a few things you should have in mind when first getting started with it.</summary>
  
  </entry>

  <entry>
    <title>Automatic Trailing Commas for Version Control</title>
    <link href="http://maximomussini.com/posts/trailing-commas/" rel="alternate" type="text/html" title="Automatic Trailing Commas for Version Control" />
    <published>2019-04-03T23:50:00-03:00</published>
  
    <updated>2019-04-03T23:50:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/trailing-commas</id>
    <content type="html" xml:base="http://maximomussini.com/posts/trailing-commas/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/trailing-commas.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;Today Iâ€™d like to share a simple but very useful practice for managing Ruby and
JS code under version control.&lt;/p&gt;

&lt;p&gt;In our team, we always use trailing commas when defining multi-line literals for
arrays and hash (object in JS) literals.&lt;/p&gt;

&lt;p&gt;Itâ€™s great that both Ruby and JS allow this in their syntax, because as a result
we are able to get cleaner diffs:&lt;/p&gt;

&lt;picture&gt;
  &lt;source srcset=&quot;/images/posts/trailing-commas/standard-vs-trailing.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot; /&gt;
  &lt;source srcset=&quot;/images/posts/trailing-commas/standard-vs-trailing-500.webp&quot; type=&quot;image/webp&quot; /&gt;
  &lt;img src=&quot;/images/posts/trailing-commas/standard-vs-trailing.png&quot; alt=&quot;Standard vs Trailing&quot; class=&quot;&quot; /&gt;
&lt;/picture&gt;

&lt;p&gt;Notice how the same code change results in a drastically simpler diff: &lt;em&gt;adding
or removing an item changes a single line, nothing more&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;automation-&quot;&gt;Automation ðŸ¤–&lt;/h2&gt;
&lt;p&gt;To make this practice effortless, we have modified the configuration of the
static analysis tools (&lt;a href=&quot;https://github.com/rubocop-hq/rubocop&quot;&gt;&lt;em&gt;Rubocop&lt;/em&gt;&lt;/a&gt; and &lt;a href=&quot;https://eslint.org/&quot;&gt;&lt;em&gt;ESLint&lt;/em&gt;&lt;/a&gt;),
to require trailing commas in multi-line literals.&lt;/p&gt;

&lt;p&gt;We have also set up &lt;a href=&quot;https://github.com/guard/guard&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Guard&lt;/code&gt;&lt;/a&gt; to listen for file changes and automatically run
the tools with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--autofix&lt;/code&gt;, so that commas are automatically added when we
forget; we donâ€™t really need to think about it.&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;ESLint&lt;/em&gt; for JS:&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;comma-dangle&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;always-multiline&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;em&gt;Rubocop&lt;/em&gt; for Ruby:&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;Style/TrailingCommaInArrayLiteral&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;EnforcedStyleForMultiline&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;comma&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;Style/TrailingCommaInHashLiteral&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;EnforcedStyleForMultiline&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;comma&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;Style/TrailingCommaInArguments&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;EnforcedStyleForMultiline&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;comma&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;An example &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Guardfile&lt;/code&gt; configuration:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Run Rubocop every time we change a file, and autofix it if possible.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:rubocop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all_on_start: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;cli: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'-a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;other-benefits-&quot;&gt;Other Benefits ðŸ‘©â€ðŸ’»ðŸ‘¨â€ðŸ’»&lt;/h2&gt;

&lt;p&gt;Reordering lines, or sorting them alphabetically with the help of an editor
(like &lt;a href=&quot;https://www.sublimetext.com/&quot;&gt;&lt;em&gt;Sublime Text&lt;/em&gt;&lt;/a&gt;), will always result in valid code,
without the need to manually add the missing comma to avoid a syntax error.&lt;/p&gt;

&lt;p&gt;Also, conflicts in &lt;a href=&quot;https://git-scm.com/&quot;&gt;source control&lt;/a&gt; are less likely to happen,
since each line change becomes independent, unlike the usual approach where we
are actually removing the last line without a comma to add two lines.&lt;/p&gt;

&lt;p&gt;Finally, tools like &lt;a href=&quot;https://git-scm.com/docs/git-blame&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git blame&lt;/code&gt;&lt;/a&gt; are more likely to display relevant commit
information, rather than the commit that added the comma.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;Using trailing commas in multi-line literals results in code that is
syntactically more stable to changes, and keeps a cleaner history in source control.&lt;/p&gt;

&lt;p&gt;Developers make less syntax errors, since they can add and remove items, sort or
reorder them, without having to manage missing (or extra) trailing commas.&lt;/p&gt;

&lt;p&gt;Weâ€™ve been using this approach for years now, and havenâ€™t run into any issues in
practice. Itâ€™s been great so far ðŸ˜ƒ&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/trailing-commas.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="development" />
  
    <category term="teamwork" />
  
    <category term="git" />
  
    <category term="devx" />
  
  
  </entry>

  <entry>
    <title>Better Settings in Ruby apps</title>
    <link href="http://maximomussini.com/posts/better-settings/" rel="alternate" type="text/html" title="Better Settings in Ruby apps" />
    <published>2019-03-02T13:32:00-03:00</published>
  
    <updated>2019-03-02T13:32:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/better-settings</id>
    <content type="html" xml:base="http://maximomussini.com/posts/better-settings/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/better-settings.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;&lt;a href=&quot;https://github.com/ElMassimo/better_settings&quot;&gt;&lt;em&gt;BetterSettings&lt;/em&gt;&lt;/a&gt; is a settings-management library for Ruby apps, which was
designed in response to certain issues we faced when using &lt;a href=&quot;https://github.com/settingslogic/settingslogic&quot;&gt;&lt;em&gt;settingslogic&lt;/em&gt;&lt;/a&gt;
(one of the most popular libraries to manage settings in Rails applications).&lt;/p&gt;

&lt;p&gt;In this post weâ€™ll talk about &lt;em&gt;settingslogic&lt;/em&gt; and its design decisions, how they
affect reliability, and how we can overcome them.&lt;/p&gt;

&lt;p&gt;Even if you are not familiar with these libraries, reading this article might
help you to learn about potentially harmful practices, and how to avoid them in
your own code.&lt;/p&gt;

&lt;h2 id=&quot;settingslogic&quot;&gt;Settingslogic&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Settingslogic&lt;/em&gt; can read a &lt;em&gt;.yml&lt;/em&gt; file and turn it into a Ruby object, which
provides access to settings by indexing it as a Hash, or by using method calls.&lt;/p&gt;

&lt;h3 id=&quot;settings-can-be-modified&quot;&gt;Settings can be modified&lt;/h3&gt;
&lt;p&gt;The library aims to be flexible, by allowing to create a setting that is not
present in the file or modify an existing one, by using:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'property'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'value'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although it might seem like a good idea, this behavior introduces uncertainty
about whether a setting will be available or not when accessing it, and the
value it might have, since that depends on the execution order of the program.&lt;/p&gt;

&lt;p&gt;Because the library is not thread-safe, modifying settings makes them suceptible
to race conditions in multi-threaded apps or multi-threaded app containers.&lt;/p&gt;

&lt;h3 id=&quot;values-are-mutable&quot;&gt;Values are mutable&lt;/h3&gt;
&lt;p&gt;Even when not creating or modifying a setting at runtime, the values read from
the &lt;em&gt;.yml&lt;/em&gt; file can be accidentally modified since the settings are not frozen
(specially &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;String&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Array&lt;/code&gt; values).&lt;/p&gt;

&lt;p&gt;For example, when working with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Array&lt;/code&gt; setting, calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;merge!&lt;/code&gt; or
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;push&lt;/code&gt; causes the setting to be changed on every subsequent access, which can
have unpredictable consequences in the application.&lt;/p&gt;

&lt;p&gt;These accidental mutations are usually very hard to detect, and can cause bugs
that are difficult to replicate and track down.&lt;/p&gt;

&lt;p&gt;Writing code carefully to avoid mutating the data structures is not enough,
since we have no guarantee that third-party libraries will be as careful. To
solve this we would need to always clone settings before handing them over,
which is cumbersome and error-prone.&lt;/p&gt;

&lt;h3 id=&quot;limited-to-a-single-file&quot;&gt;Limited to a single file&lt;/h3&gt;
&lt;p&gt;Only one &lt;em&gt;.yml&lt;/em&gt; file can be specified, so thereâ€™s no way to read configuration
from multiple files. Because settings are necessary to run the application, itâ€™s
important that the file is versioned under source control.&lt;/p&gt;

&lt;p&gt;In our case, this meant that when developers changed a setting based on their
local setup, or to perform a manual test, they had to manually skip it when
making a commit.&lt;/p&gt;

&lt;p&gt;As a result, many times a developer would accidentally push these changes that
should not be merged upstream, and we had to be on the lookout during code
reviews to prevent unwanted changes.&lt;/p&gt;

&lt;h3 id=&quot;error-prone-design&quot;&gt;Error-prone design&lt;/h3&gt;
&lt;p&gt;These problems we experienced with &lt;em&gt;settingslogic&lt;/em&gt;, related with reliability and
collaboration, are a consequence of the design decisions in the library.&lt;/p&gt;

&lt;p&gt;The library defaults are troublesome, such as deferring the load of the &lt;em&gt;.yml&lt;/em&gt;
file until the settings are accessed, making it possible for an app to start
successfully and fail later at runtime.&lt;/p&gt;

&lt;p&gt;In the end, it has the same disadvantages of simpler approaches, like using a
plain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OpenStruct&lt;/code&gt; to manage settings.&lt;/p&gt;

&lt;h2 id=&quot;a-better-way&quot;&gt;A &lt;em&gt;Better&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;With that in mind, we decided to design a new solution from scratch, that could
handle these shortcomings, and actively prevent bugs and misusage.&lt;/p&gt;

&lt;p&gt;The result is &lt;a href=&quot;https://github.com/ElMassimo/better_settings&quot;&gt;&lt;em&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BetterSettings&lt;/code&gt;&lt;/em&gt;&lt;/a&gt;, designed after the following concerns:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Predictability&lt;/strong&gt;: Once created, settings can not be added or modified, which
prevents race conditions and makes usage safe and predictable.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Immutability&lt;/strong&gt;: All setting values are frozen, preventing an entire category
of bugs related to accidental mutation.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Multiple sources&lt;/strong&gt;: Settings can be read from different files. This allows
to split settings as needed, or create additional files for development purposes.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Better errors&lt;/strong&gt;: Accessing a missing setting is treated as an error, helping
developers to easily detect typos and other mistakes with a clear error message.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Fail-fast&lt;/strong&gt;: Source files should be eager loaded by default, so that
problems in the environment are detected during deployment.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The setup for the &lt;em&gt;.yml&lt;/em&gt; file is very similar to &lt;em&gt;settingslogic&lt;/em&gt;, you can find
more information and examples in the &lt;a href=&quot;https://github.com/ElMassimo/better_settings&quot;&gt;README&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;how-does-it-work&quot;&gt;How does it work?&lt;/h3&gt;
&lt;p&gt;Internally, settings are stored in a frozen &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt;, which is an instance
variable in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BetterSettings&lt;/code&gt; object. We delegate &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;to_h&lt;/code&gt; to this internal
hash for easy access, but other than that, we donâ€™t expose any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; methods.&lt;/p&gt;

&lt;p&gt;We go through every hash &lt;em&gt;entry&lt;/em&gt;, processing any nested &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Array&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; objects,
freezing every wrapped &lt;em&gt;value&lt;/em&gt;, setting it in an instance variable, and making it
accessible by defining a getter for that &lt;em&gt;key&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Itâ€™s worth noting that we wrap nested &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hash&lt;/code&gt; values in instances of your
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BetterSettings&lt;/code&gt; class, which will recursively repeat the process.&lt;/p&gt;

&lt;p&gt;As a result, the entire settings graph is readable but immutable, and each
nested object exposes getters for the available keys.&lt;/p&gt;

&lt;p&gt;To make errors a bit friendlier, we implement &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;method_missing&lt;/code&gt; to provide
context on where a setting is missing, instead of an unhelpful &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NoMethodError&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Finally, we sprinkle some syntax sugar by making every top-level key available
as a method in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Settings&lt;/code&gt; class, by delegating it to a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root_settings&lt;/code&gt;
instance that is populated when calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;source&lt;/code&gt; in the class.&lt;/p&gt;

&lt;h3 id=&quot;reading-from-multiple-files-&quot;&gt;Reading from multiple files âš™&lt;/h3&gt;
&lt;p&gt;Not being limited to a single source file opens up the possiblities.&lt;/p&gt;

&lt;p&gt;We usually read two optional files: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;development.yml&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test.yml&lt;/code&gt; that are
loaded in the &lt;em&gt;development&lt;/em&gt; and &lt;em&gt;test&lt;/em&gt; environments respectively, allowing each
developer to easily override settings in their local setup.&lt;/p&gt;

&lt;p&gt;In a Rails app with the typical setup, the configuration looks like this:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Settings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;BetterSettings&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'config/application.yml'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;namespace: &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;development?&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'config/development.yml'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;namespace: &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;optional: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;test?&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'config/test.yml'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;namespace: &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;optional: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Having a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;development.yml&lt;/code&gt; file comes in handy when making changes that should
not be shared, such as a temporary change to test a different configuration, or
a permanent one that is only relevant in a specific local setup (such as
different host names or port numbers).&lt;/p&gt;

&lt;p&gt;This could also be achieved by reading environment variables (&lt;a href=&quot;#environment-variables&quot;&gt;see the next
section&lt;/a&gt;), but for development using an optional file is
more convenient, as itâ€™s located in the same folder than the main one, and
settings can be copied and tweaked.&lt;/p&gt;

&lt;p&gt;On the other hand, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test.yml&lt;/code&gt; makes it possible to configure tests to run with a
different formatter for the results, or configure optional behavior, like
automatically opening the screenshots that are captured when integration tests
fail.&lt;/p&gt;

&lt;p&gt;This flexibility enables us to provide awesome defaults, while still allowing
everyone to modify the configuration according to their personal preference or
local setup, without having to worry about pushing those changes by accident.&lt;/p&gt;

&lt;h3 id=&quot;environment-variables&quot;&gt;Environment Variables&lt;/h3&gt;
&lt;p&gt;In server environments, such as &lt;em&gt;staging&lt;/em&gt; and &lt;em&gt;production&lt;/em&gt;, we use environment
variables for any sensitive information, such as passwords.&lt;/p&gt;

&lt;p&gt;In order to ensure that missing environment variables are quickly detected, we
use this simple helper:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Env&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Public: Read an environment variable by name.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# NOTE: Defaults are only used in the development and test environments.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;development?&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;test?&lt;/span&gt;
      &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;application.yml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;mailer&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;%= Env.require('MAILER_PORT', 587) %&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By using this helper, we can be very &lt;em&gt;strict on servers&lt;/em&gt;ï¼where we need
everything to be configured (such as hosts, ports, and third-party integrations)ï¼and
&lt;em&gt;lenient in development&lt;/em&gt;ï¼where we can just provide a default value and then
override it by using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;development.yml&lt;/code&gt; if necessary.&lt;/p&gt;

&lt;p&gt;We prefer this pattern over using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ENV.fetch&lt;/code&gt; with a default value as a
fallback, since that would cover up a missing environment variable in the servers.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;So there you have it, &lt;a href=&quot;https://github.com/ElMassimo/better_settings&quot;&gt;&lt;em&gt;BetterSettings&lt;/em&gt;&lt;/a&gt; is a settings solution
for Ruby apps that encourages good practices, is friendlier for team
collaboration and source-control, and prevents bugs.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ElMassimo/better_settings&quot;&gt;&lt;em&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BetterSettings&lt;/code&gt;&lt;/em&gt;&lt;/a&gt;: simple, immutable, better.&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/better-settings.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="ruby" />
  
    <category term="rails" />
  
    <category term="settings" />
  
    <category term="libraries" />
  
  
  </entry>

  <entry>
    <title>i18n Multitenancy: Customer-Specific Translations</title>
    <link href="http://maximomussini.com/posts/i18n-multitenant/" rel="alternate" type="text/html" title="i18n Multitenancy: Customer-Specific Translations" />
    <published>2017-01-26T00:00:00-03:00</published>
  
    <updated>2017-01-26T00:00:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/i18n-multitenant</id>
    <content type="html" xml:base="http://maximomussini.com/posts/i18n-multitenant/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/i18n-multitenant.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;When providing services to different companies or customers with the same
software, such as enterprise or white-label applications, itâ€™s not unusual that
each customer uses different terminology for certain concepts within the application.&lt;/p&gt;

&lt;p&gt;While they might be similar in terms of operations and transactions, different
domains will often use different jargon, and as a result, prefer different names
for a given feature or aspect of an application.&lt;/p&gt;

&lt;p&gt;For example, a concept that in our application is &lt;em&gt;â€œpersonâ€&lt;/em&gt;, might be referred to
as &lt;em&gt;â€œuserâ€&lt;/em&gt;, &lt;em&gt;â€œcustomerâ€&lt;/em&gt;, or &lt;em&gt;â€œemployeeâ€&lt;/em&gt;, based on the language of their specific
domain, or when using their &lt;em&gt;in-house&lt;/em&gt; terminology.&lt;/p&gt;

&lt;p&gt;Using the same terms than our users in their every day routine can help to make
the software feel more natural and easier to grasp, lowering the adoption
barrier and reducing the resistance to change in large organizations.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;â€¦fits right in with our usual flow.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;using-i18n-fallbacks-&quot;&gt;Using i18n fallbacks ðŸŒŽ&lt;/h2&gt;

&lt;p&gt;Fortunately, we can easily accomplish this by leveraging the existing i18n tools
that are available in most platforms.&lt;/p&gt;

&lt;p&gt;Just like we might allow a customer to switch between American or British
variants of the English language (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;en-US&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;en-UK&lt;/code&gt;), we can create additional
language-variants or locales for each customer or domain (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;en-LAW&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;en-LAW&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;client&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can then use i18n fallbacks, so that any keys that are not defined in our
domain-specific locale &lt;em&gt;fall back&lt;/em&gt; to the usual definition in the language.&lt;/p&gt;

&lt;p&gt;In the example above, any users that have the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LAW&lt;/code&gt; translation preset assigned
would see &lt;em&gt;â€œclientâ€&lt;/em&gt;, but other users might see &lt;em&gt;â€œcustomerâ€&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This allows us to achieve a nice balance between configurability and productivity.&lt;/p&gt;

&lt;p&gt;By managing these text overrides within the translation engine, it becomes
almost effortless to dynamically customize the language used in the app.&lt;/p&gt;

&lt;p&gt;Dictionaries for different domains or specific customers can be added with ease,
and it becomes easier to test all the different combinations in the application.&lt;/p&gt;

&lt;h2 id=&quot;a-solution-for-ruby-apps-&quot;&gt;A solution for Ruby apps ðŸ’Ž&lt;/h2&gt;

&lt;p&gt;I have wrapped a Ruby solution as the &lt;a href=&quot;https://github.com/ElMassimo/i18n_multitenant&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i18n_multitenant&lt;/code&gt;&lt;/a&gt; gem.
Please &lt;a href=&quot;https://github.com/ElMassimo/i18n_multitenant&quot;&gt;check the readme&lt;/a&gt; for a more thorough explanation of
how language variants are used, and a few examples on how to organize
translations in order to effectively implement the approach.&lt;/p&gt;

&lt;h3 id=&quot;what-about-translations-in-the-browser&quot;&gt;What about translations in the browser?&lt;/h3&gt;

&lt;p&gt;For single-page applications or other apps where itâ€™s desirable to perform the
translations in the browser, we can use a library such as &lt;a href=&quot;https://github.com/fnando/i18n-js&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i18n-js&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Itâ€™s possible to &lt;a href=&quot;https://github.com/ElMassimo/i18n_multitenant#front-end_translations&quot;&gt;configure it to use fallbacks&lt;/a&gt;,
allowing us to reuse the same translation files in the JS world.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i18n&lt;/code&gt; fallbacks provide a simple way to adapt the terminology used in our
software based on different domains and users needs, making it &lt;em&gt;feel more familiar&lt;/em&gt;
and easier to use &lt;em&gt;without restricting the softwareâ€™s flexibility&lt;/em&gt;.&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/i18n-multitenant.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="i18n" />
  
    <category term="translations" />
  
    <category term="enterprise" />
  
    <category term="libraries" />
  
  
  </entry>

  <entry>
    <title>Aggregation DSL in Mongoid</title>
    <link href="http://maximomussini.com/posts/mongoid-aggregation-dsl/" rel="alternate" type="text/html" title="Aggregation DSL in Mongoid" />
    <published>2016-06-30T16:19:00-03:00</published>
  
    <updated>2016-06-30T16:19:00-03:00</updated>
  
    <id>http://maximomussini.com/posts/mongoid-aggregation-dsl</id>
    <content type="html" xml:base="http://maximomussini.com/posts/mongoid-aggregation-dsl/">
      &lt;picture&gt;
  &lt;source srcset=&quot;http://maximomussini.webp&quot; type=&quot;image/webp&quot; media=&quot;(min-width: 600px)&quot;&gt;
  &lt;source srcset=&quot;http://maximomussini-500.webp&quot; type=&quot;image/webp&quot;&gt;
  &lt;img src=&quot;http://maximomussini.com/images/posts/mongoid-aggregation-dsl.jpg&quot; alt=&quot;Post Image&quot; class=&quot;post-image&quot;&gt;
&lt;/picture&gt;

      &lt;p&gt;&lt;em&gt;Mongoid&lt;/em&gt; provides support for &lt;a href=&quot;https://docs.mongodb.com/manual/core/aggregation-pipeline/&quot;&gt;&lt;em&gt;MongoDBâ€™s Aggregation Framework&lt;/em&gt;&lt;/a&gt;, but writing raw queries can be confusing and is extremely verbose:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$match'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'country'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'US'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$project'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'categories'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'price'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$unwind'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;'$group'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;'_id'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s1&quot;&gt;'avg_price'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$avg'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$price'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$sort'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'avg_price'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$limit'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Turns out &lt;a href=&quot;https://github.com/mongoid/origin&quot;&gt;&lt;em&gt;Origin&lt;/em&gt;&lt;/a&gt;â€”the gem that powers &lt;em&gt;Mongoidâ€™s&lt;/em&gt; query DSLâ€”already provides methods for each aggregation operation. The only problem is that it doesnâ€™t provide a way to execute the aggregation, and thereâ€™s no documentation about it :grimacing:&lt;/p&gt;

&lt;p&gt;Every aggregation method call adds an operation to an internal pipeline, which we can manually retrieve by calling the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pipeline&lt;/code&gt; method:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;products&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;country: :US&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;categories: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;price: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;unwind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;_id: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:avg_price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;avg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$price'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:avg_price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;products&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pipeline&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$match&quot;=&amp;gt;{&quot;country&quot;=&amp;gt;:US}}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$project&quot;=&amp;gt;{&quot;categories&quot;=&amp;gt;1, &quot;price&quot;=&amp;gt;1}}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$unwind&quot;=&amp;gt;&quot;$category_ids&quot;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$group&quot;=&amp;gt;{&quot;_id&quot;=&amp;gt;&quot;$category_ids&quot;, &quot;avg_price&quot;=&amp;gt;{&quot;$avg&quot;=&amp;gt;&quot;$price&quot;}}}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$sort&quot;=&amp;gt;{&quot;avg_price&quot;=&amp;gt;-1}}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# {&quot;$limit&quot;=&amp;gt;30}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice how using the DSL we obtain the same aggregation pipeline that we have in the first example, except itâ€™s way more concise, and we are able to use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; extensions like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;avg&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max&lt;/code&gt;, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;add_to_set&lt;/code&gt;, which add a great deal of expressiveness and make our queries more concise.&lt;/p&gt;

&lt;p&gt;Now all we have to do is pass the pipeline to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; method:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;products&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pipeline&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can add a little syntax sugar using refinements and make it even more convenient:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;AggregationRefinements&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;refine&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Mongoid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Criteria&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pipeline&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AggregationRefinements&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;categories: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;price: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;unwind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;_id: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'$category_ids'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:avg_price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;avg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$price'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or if you are using &lt;a href=&quot;https://github.com/ElMassimo/queryable&quot;&gt;&lt;strong&gt;query objects&lt;/strong&gt;&lt;/a&gt;, itâ€™s as simple as adding a method to the objects where you need to perform aggregations:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;queryable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queryable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pipeline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we can enjoy &lt;em&gt;Mongoidâ€™s&lt;/em&gt; fluent DSL for aggregations :smiley:&lt;/p&gt;
    </content>
    <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://maximomussini.com/images/posts/mongoid-aggregation-dsl.jpg" />
    <author>
      <name>MÃ¡ximo Mussini</name>
      <email>maximomussini@gmail.com</email>
    </author>
    <category term="posts" />
  
    <category term="mongoid" />
  
    <category term="mongodb" />
  
    <category term="aggregation" />
  
  
  </entry>

</feed>
