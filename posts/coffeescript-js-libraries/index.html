<!DOCTYPE html>
<html lang="en">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>

  CoffeeScript and JS Libraries · Máximo Mussini

</title>
<meta name="author" content="Máximo Mussini">
<meta name="description" content="">
<meta name="keywords" content="">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="cleartype" content="on">

<!-- Styles -->
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:700,800,900|Lato:300,300italic,400,400italic,700,900" type="text/css">
<link rel="stylesheet" href="/assets/css/styles.css" media="screen, projection">

<!-- Icons -->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.jpg">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="Máximo Mussini · Code and Design">

<!-- Facebook Stuff -->
<meta property="og:locale" content="en_US">
<meta property="og:title" content="CoffeeScript and JS Libraries">
<meta property="og:description" content="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using thes...">
<meta property="og:url" content="http://maximomussini.com/posts/coffeescript-js-libraries">
<meta property="og:site_name" content="Máximo Mussini">


  <body>
    <header>
  
    <div class="hero" style="background-image: url(/images/posts/coffeescript-js-libraries.jpg)">
      <h1>CoffeeScript and JS Libraries</h1>
    </div>
  
</header>

    <div class="menu container">
  <ul>
    
<li>
  <a href="/about/">About</a>
</li>

    
<li>
  <a href="/posts/">Posts</a>
</li>

    <li>
      <a href="/" class="logo">
  <span class="text">M</span>
</a>

    </li>
    
<li>
  <a href="/projects/">Projects</a>
</li>

    
<li>
  <a href="/talks/">Talks</a>
</li>

  </ul>
  <hr />
</div>

    <div class="content container">
  

  <div class="post-info">
  <span class="date">December 31, 2015</span>
  <span class="reading-time">3 min read</span>
</div>


  <div class="post">
    <p>A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.</p>

<p>In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. <a href="http://coffeescript.org/"><em>CoffeeScript</em></a> was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like <a href="http://elm-lang.org/"><em>Elm</em></a>, <a href="https://github.com/clojure/clojurescript"><em>ClojureScript</em></a>, <a href="http://opalrb.org/"><em>Opal</em></a>, and <a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS">many more</a>.</p>

<p>Recently, we were trying to debug a strange issue with <a href="http://www.nick-cherry.com">one of my coworkers</a>, where we had a list of selectable items with a checkbox to select/unselect all the items. Selecting all the items was working properly, but only the first item got unselected.</p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all_broken.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>After debugging it for a while we reached the conclusion that the iteration was being interrupted. Could <a href="http://lodash.com"><code>lodash</code></a> have such a serious bug?</p>

<div class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nv">selectAll = </span><span class="nf">(isSelected) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="nf">(task) -&gt;</span> <span class="nv">task.selected = </span><span class="nx">isSelected</span></code></pre></div>

<p>Fortunately, we decided to skip that theory, and instead reached for the <a href="https://lodash.com/docs#forEach">documentation</a>, which stated:</p>

<blockquote>
  <p>Iteratee functions may exit iteration early by explicitly returning false.</p>
</blockquote>

<p>Which sounds like a reasonable feature that can help to create more efficient algorithms—though we weren’t returning <code>false</code>!</p>

<p>But CoffeeScript was. The language draws inspiration from Ruby, and it borrows features like expressions and implicit returns. For functions, this means that the last executed expression becomes the return value of the function. This allows us to write very concise functions:</p>

<div class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nv">isEven = </span><span class="nf">(n) -&gt;</span> <span class="nx">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span></code></pre></div>

<p>If we reinterpret our snippet above taking implicit returns into account, it is equivalent to:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">selectAll</span><span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">task</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="nx">isSelected</span> <span class="p">})</span>
<span class="p">}</span></code></pre></div>

<p>When we unselect all the items and <code>selectAll(false)</code> is called, the first iteration returns the value of <code>task.selected</code> which is <code>false</code>, causing <em>lodash</em> to exit the iteration. Mistery solved <img class="emoji" title=":mag:" alt=":mag:" src="https://assets.github.com/images/icons/emoji/unicode/1f50d.png" height="20" width="20" align="absmiddle" /></p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>We can fix the bug by explicitly returning <code>null</code> or <code>true</code> on each loop, which will avoid stopping the iteration, and all the items will be unselected correctly.</p>

<div class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nv">selectAll = </span><span class="nf">(isSelected) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="nf">(task) -&gt;</span>
    <span class="nv">task.selected = </span><span class="nx">isSelected</span>
    <span class="kc">true</span></code></pre></div>

<p>These are two useful features on their own, yet extremely inconvenient when combined. The reason is that the library was written for a language with a different mindset. The design of the language and the design of the library are not fully compatible.</p>

<h2 id="tldr">TL;DR</h2>
<p>Watch out for language differences when using libraries written for another language, they will bite sooner or later.</p>

  </div>

  <div class="ending">
  <div class="author">
    <a href="/" class="logo">
  <span class="text">M</span>
</a>

    By
    <a href="https://twitter.com/MaximoMussini" class="author-name short">@Maximo</a>
    <a href="https://twitter.com/MaximoMussini" class="author-name full">@MaximoMussini</a>
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="MaximoMussini" data-dnt="true">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>
</div>

</div>



  <a id="next-post" href="/posts/anko-vs-android-xml/" class="hidden"></a>




  <div class="previous-post">
    <div class="content container">
      <a id="previous-post" href="/posts/bash-git-prompt/" class="overlay">
        <h1>Improving your Git Experience in Bash</h1>
        <div class="post-info">
  <span class="date">December 14, 2015</span>
  <span class="reading-time">4 min read</span>
</div>

        <div class="post">
          <p><em>Bash</em> is the default terminal for most Unix distributions, so it’s very appealing to get the best out of it. If you enjoy customizing your setup, you might want to try something like <span href="http://ohmyz.sh/">zsh</span> instead, which comes with similar functionality out of the box.</p>

<p>Let’s take a look at how we can improve our <em>Git</em> usage in <em>bash</em> by adding a few plugins <img class="emoji" title=":neckbeard:" alt=":neckbeard:" src="https://assets.github.com/images/icons/emoji/neckbeard.png" height="20" width="20" align="absmiddle"></p>

<h2 id="bash-git-autocompletion">Bash Git Autocompletion</h2>
<p>A great way to get <em>Git</em> autocompletion is to…</p>
        </div>
      </a>
    </div>
  </div>



    <script>
if (document.location.hostname.search('maximomussini.com') !== -1) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-67510525-1', 'auto');
  ga('send', 'pageview');
}
</script>

<script src="/assets/js/anchors.js"></script>
<script src="/assets/js/shortcuts.js"></script>

  </body>
</html>
