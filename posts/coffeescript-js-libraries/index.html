<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>

  CoffeeScript and JS Libraries · Máximo Mussini

</title>

<meta name="author" content="Máximo Mussini">
<meta name="description" content="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …">
<meta name="keywords" content="rails, coffeescript, js">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="cleartype" content="on">
<meta name="theme-color" content="#5C7E8F" />

<!-- Styles -->
<link rel="preconnect" href="//fonts.googleapis.com">
<link rel="preconnect" href="//www.google-analytics.com">
<link rel="preload" href="//fonts.googleapis.com/css?family=Raleway:700,800,900|Lato:400,400italic,700,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="this.rel='stylesheet'" type="text/css" media="screen, projection">
<link rel="stylesheet" href="/assets/css/styles.css?v=4" media="screen, projection">

<!-- Icons -->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" sizes="192x192" href="/icon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.jpg">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="Máximo Mussini · Code and Design">

<!-- Facebook Stuff -->
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:url" content="http://maximomussini.com/posts/coffeescript-js-libraries/">
<meta property="og:site_name" content="Máximo Mussini">
<meta property="og:title" content="CoffeeScript and JS Libraries">
<meta property="og:image" content="http://maximomussini.com/images/posts/coffeescript-js-libraries.jpg">
<meta property="og:description" content="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …">

<!-- Twitter Stuff -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:domain" value="maximomussini.com" />
<meta name="twitter:title" value="CoffeeScript and JS Libraries" />
<meta name="twitter:description" value="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …" />
<meta name="twitter:image" content="http://maximomussini.com/images/posts/coffeescript-js-libraries.jpg" />
<meta name="twitter:url" value="http://maximomussini.com/posts/coffeescript-js-libraries/" />

  </head>
  <body>
    <header style="background-image: url('data:image/webp;base64,UklGRsADAABXRUJQVlA4ILQDAACwJACdASoaAWQAPslYoku/u7WlLrjda/AZCWctgYnq+OaTENccT7JNmCVIyikgt/5fo17mETV75BOLLNb0iATBzX5h8gJrlVs6Ef9is2bpa/ojAcamtKz/N6bxijjKXqU43+7LfevUQxih2C/ToFgpIGmlvA13KVAknP/Uc8FKK7721gzo2ebhJVIhCR+PJSpbqwqQxczXrdA5tZ+FfLadfpm4nkzZPa7QwMmzFqrxhKypmjaE1D5PNvCvTOsZX3TTPEr39H9zB+OFN0TsYTRzPxGuNTCKJwf+e5O0ylS2qtuqAg46Xqg9+MLQ7GvhwfecUuxWrCCBakK+M57nepWt1i4Zxkhkx83027ovy4o+/WZhpaxp7KF+zuEBa6E4wJseWOWduXfsBrFGZyCjAADJn9GzTLcqe0rl0z9rt4kyH176mu3mSvXUP+ES8SqgnAKAyCu2Qw1mmex6DiQyym+fU+JrEDS1Rytih/f/bfPtsVR62Fz1E2PcLWuGbAz1xCRXmbKBQp0OaDz6IBK1OehAN7mp9LLoQsyfTi/KACC1YPk3reBlWq69ffmKGKnVODQfY+7TxCXqjcl/023k/6FdfNkJouS6UHhJsiM1kqTBPBaBhCIT0PJ8ObE0QOr3Gsns+PlmEVi5VVIiQatOYldmjL5urg9kc1erET8ijvn27ikG8nkOZetiXwhPBKhJ2eKhNeu2Lo9RSVc9QparwHhgh+Ie2eg+PMy3F0Z2ODNQtOmqkyC9y+fxoivyo86YX/fp2PfOFrEZ9KfOIlrB0jUrrPA5/XMMPDE/HP4kpyj62BMmd67v6VuTDPAO1meS9Gbmth7sY6wKnI40OHbWd6IIxEgcl8moVmG3WOkNQ+z/jTghr1VPsRzfUJhd/k7MDmrcYHij1mHHZIyQnYkUFpF+GSCEBhl3u38o//hx+z26inCzdD1y/BWaekyNkxdSCExNvfyyOjXWAjYTRSKIipWyUkBCMqSORrORISkxQ9PnTM3uoyhZVyyy29la2aU06DeWubLpm+8gXtz6Ca1P8jqQ/Xl19tC3jTGu530RVGy4FVs7loN24LgrtQ2a/Xoobj1zoq9RXaZE1FWxfRVy5maAjM5uirk1Az9cxXTzqMfRusRaWKCbJu//u7itaw2+MvP3r4w6zCfW6t1qoLL8AVPZcko8sHa1NliGPI3bsSQ8zywZ/DkT67nqdYlq5nJjmD0AEW1h5n38gQTg/7f5ipyQaNBoIPCNASUeTtv78iPptSf8AAA=')">
  
    <div class="hero">
      <picture>
  <source srcset="/images/posts/coffeescript-js-libraries.webp" type="image/webp" media="(min-width: 600px)">
  <source srcset="/images/posts/coffeescript-js-libraries-500.webp" type="image/webp">
  <img src="/images/posts/coffeescript-js-libraries.jpg" alt="coffeescript-js-libraries.jpg" class="hero-bg">
</source></source></picture>

      <h1 class="hero-title">CoffeeScript and JS Libraries</h1>
    </div>
  
</header>

    <div class="menu container">
  <ul>
    
<li>
  <a href="/about/">About</a>
</li>

    
<li>
  <a href="/posts/">Posts</a>
</li>

    <li>
      <a href="/" class="logo">
  <img class="logo-img" src="/assets/icons/logo.svg" alt="Logo">
</a>

    </li>
    
<li>
  <a href="/projects/">Projects</a>
</li>

    
<li>
  <a href="/talks/">Talks</a>
</li>

  </ul>
  <hr>
</div>

    <div class="content container">
  

  <div class="post-info">
  <span class="date">December 31, 2015</span>
  <span class="reading-time">3 min read</span>
</div>


  <div class="post">
    <p>A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.</p>

<p>In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. <a href="https://coffeescript.org/"><em>CoffeeScript</em></a> was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like <a href="https://elm-lang.org/"><em>Elm</em></a>, <a href="https://github.com/clojure/clojurescript"><em>ClojureScript</em></a>, <a href="https://opalrb.com/"><em>Opal</em></a>, and <a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS">many more</a>.</p>

<p>Recently, we were trying to debug a strange issue with <a href="http://www.nick-cherry.com">one of my coworkers</a>, where we had a list of selectable items with a checkbox to select/unselect all the items. Selecting all the items was working properly, but only the first item got unselected.</p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all_broken.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>After debugging it for a while we reached the conclusion that the iteration was being interrupted. Could <a href="http://lodash.com"><code class="language-plaintext highlighter-rouge">lodash</code></a> have such a serious bug?</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">selectAll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="na">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">task</span><span class="p">.</span><span class="na">selected</span> <span class="o">=</span> <span class="nx">isSelected</span></code></pre></figure>

<p>Fortunately, we decided to skip that theory, and instead reached for the <a href="https://lodash.com/docs#forEach">documentation</a>, which stated:</p>

<blockquote>
  <p>Iteratee functions may exit iteration early by explicitly returning false.</p>
</blockquote>

<p>Which sounds like a reasonable feature that can help to create more efficient algorithms—though we weren’t returning <code class="language-plaintext highlighter-rouge">false</code>!</p>

<p>But CoffeeScript was. The language draws inspiration from Ruby, and it borrows features like expressions and implicit returns. For functions, this means that the last executed expression becomes the return value of the function. This allows us to write very concise functions:</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">isEven</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span></code></pre></figure>

<p>If we reinterpret our snippet above taking implicit returns into account, it is equivalent to:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">selectAll</span><span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">task</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="nx">isSelected</span> <span class="p">})</span>
<span class="p">}</span></code></pre></figure>

<p>When we unselect all the items and <code class="language-plaintext highlighter-rouge">selectAll(false)</code> is called, the first iteration returns the value of <code class="language-plaintext highlighter-rouge">task.selected</code> which is <code class="language-plaintext highlighter-rouge">false</code>, causing <em>lodash</em> to exit the iteration. Mistery solved <img class="emoji" title=":mag:" alt=":mag:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f50d.png" height="20" width="20"></p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>We can fix the bug by explicitly returning <code class="language-plaintext highlighter-rouge">null</code> or <code class="language-plaintext highlighter-rouge">true</code> on each loop, which will avoid stopping the iteration, and all the items will be unselected correctly.</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">selectAll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="na">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">task</span><span class="p">.</span><span class="na">selected</span> <span class="o">=</span> <span class="nx">isSelected</span>
    <span class="no">true</span></code></pre></figure>

<p>These are two useful features on their own, yet extremely inconvenient when combined. The reason is that the library was written for a language with a different mindset. The design of the language and the design of the library are not fully compatible.</p>

<h2 id="tldr">TL;DR</h2>
<p>Watch out for language differences when using libraries written for another language, they will bite sooner or later.</p>

  </div>

  <div class="ending">
  <a href="/" class="logo">
  <img class="logo-img" src="/assets/icons/logo.svg" alt="Logo">
</a>

  <span>by</span>
  <a href="https://twitter.com/MaximoMussini" class="author-name">Máximo<span class="last-name"> Mussini</span></a>
  <a class="twitter-share-button" href="//twitter.com/intent/tweet?original_referer=http://maximomussini.com/posts/coffeescript-js-libraries/&amp;ref_src=twsrc%5Etfw&amp;text=CoffeeScript%20and%20JS%20Libraries%20%C2%B7%20M%C3%A1ximo%20Mussini&amp;tw_p=tweetbutton&amp;url=http://maximomussini.com/posts/coffeescript-js-libraries/&amp;via=MaximoMussini" rel="noopener" target="_blank"><i class="twitter-icon"></i><span class="twitter-label">Tweet</span></a>

</div>

</div>



  <a id="next-post" href="/posts/anko-vs-android-xml/" class="hidden"></a>




  <a id="previous-post" href="/posts/bash-git-prompt/" class="hidden"></a>




  <div class="related-post">
    <div class="content container">
      <a id="related-post" href="/posts/vuex-stores/" class="overlay">
        <h1>Store Objects for Vuex</h1>
        <div class="post-info">
  <span class="date">May 12, 2020</span>
  <span class="reading-time">4 min read</span>
</div>

        <div class="post">
          <p><span href="%7B%7Bpage.vuex%7D%7D">Vuex</span> is a state-management solution that integrates nicely with
<span href="%7B%7Bpage.vue%7D%7D">Vue</span> components.</p>

<p>When starting to use Vuex, one quickly realizes that it’s easier to manage and
understand the state of a large application when the state is split between
different <span href="%7B%7Bpage.modules%7D%7D">modules in the Vuex store</span>.</p>

<p>Unfortunately, working with modules involves using a <em>namespace string</em> to
access state and getters, which makes typos hard…</p>
        </div>
      </a>
    </div>
  </div>



    <script>
if (document.location.hostname.search('maximomussini.com') !== -1) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-67510525-1', 'auto');
  ga('send', 'pageview');
}
</script>

<script src="/assets/js/anchors.js" async></script>
<script src="/assets/js/shortcuts.js" async></script>

  </body>
</html>
