<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>

  CoffeeScript and JS Libraries · Máximo Mussini

</title>

<meta name="author" content="Máximo Mussini">
<meta name="description" content="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …">
<meta name="keywords" content="">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="cleartype" content="on">
<meta name="theme-color" content="#5C7E8F" />

<!-- Styles -->
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:700,800,900|Lato:400,400italic,700,900&display=swap" type="text/css">
<link rel="stylesheet" href="/assets/css/styles.css" media="screen, projection">

<!-- Icons -->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" sizes="192x192" href="/icon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.jpg">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="Máximo Mussini · Code and Design">

<!-- Facebook Stuff -->
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:url" content="http://maximomussini.com/posts/coffeescript-js-libraries/">
<meta property="og:site_name" content="Máximo Mussini">
<meta property="og:title" content="CoffeeScript and JS Libraries">
<meta property="og:image" content="http://maximomussini.com/images/posts/coffeescript-js-libraries.jpg">
<meta property="og:description" content="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …">

<!-- Twitter Stuff -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:domain" value="maximomussini.com" />
<meta name="twitter:title" value="CoffeeScript and JS Libraries" />
<meta name="twitter:description" value="A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.

In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. CoffeeScript was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like Elm, …" />
<meta name="twitter:image" content="http://maximomussini.com/images/posts/coffeescript-js-libraries.jpg" />
<meta name="twitter:url" value="http://maximomussini.com/posts/coffeescript-js-libraries/" />

  </head>
  <body>
    <header>
  
    <div class="hero" style="background-image: url(/images/posts/coffeescript-js-libraries.jpg)">
      <h1>CoffeeScript and JS Libraries</h1>
    </div>
  
</header>

    <div class="menu container">
  <ul>
    
<li>
  <a href="/about/">About</a>
</li>

    
<li>
  <a href="/posts/">Posts</a>
</li>

    <li>
      <a href="/" class="logo">
  <span class="text">M</span>
</a>

    </li>
    
<li>
  <a href="/projects/">Projects</a>
</li>

    
<li>
  <a href="/talks/">Talks</a>
</li>

  </ul>
  <hr>
</div>

    <div class="content container">
  

  <div class="post-info">
  <span class="date">December 31, 2015</span>
  <span class="reading-time">3 min read</span>
</div>


  <div class="post">
    <p>A language helps to shape the libraries that are written on it. This can have unexpected side-effects when using these libraries from a different language.</p>

<p>In the frontend this has become increasingly more common because of all the available languages that compile to JavaScript. <a href="http://coffeescript.org/"><em>CoffeeScript</em></a> was one of the first ones to gain adoption, but nowadays we have a myriad of available languages like <a href="http://elm-lang.org/"><em>Elm</em></a>, <a href="https://github.com/clojure/clojurescript"><em>ClojureScript</em></a>, <a href="http://opalrb.org/"><em>Opal</em></a>, and <a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS">many more</a>.</p>

<p>Recently, we were trying to debug a strange issue with <a href="http://www.nick-cherry.com">one of my coworkers</a>, where we had a list of selectable items with a checkbox to select/unselect all the items. Selecting all the items was working properly, but only the first item got unselected.</p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all_broken.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>After debugging it for a while we reached the conclusion that the iteration was being interrupted. Could <a href="http://lodash.com"><code class="highlighter-rouge">lodash</code></a> have such a serious bug?</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">selectAll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="na">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">task</span><span class="p">.</span><span class="na">selected</span> <span class="o">=</span> <span class="nx">isSelected</span></code></pre></figure>

<p>Fortunately, we decided to skip that theory, and instead reached for the <a href="https://lodash.com/docs#forEach">documentation</a>, which stated:</p>

<blockquote>
  <p>Iteratee functions may exit iteration early by explicitly returning false.</p>
</blockquote>

<p>Which sounds like a reasonable feature that can help to create more efficient algorithms—though we weren’t returning <code class="highlighter-rouge">false</code>!</p>

<p>But CoffeeScript was. The language draws inspiration from Ruby, and it borrows features like expressions and implicit returns. For functions, this means that the last executed expression becomes the return value of the function. This allows us to write very concise functions:</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">isEven</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span></code></pre></figure>

<p>If we reinterpret our snippet above taking implicit returns into account, it is equivalent to:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">selectAll</span><span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">task</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="nx">isSelected</span> <span class="p">})</span>
<span class="p">}</span></code></pre></figure>

<p>When we unselect all the items and <code class="highlighter-rouge">selectAll(false)</code> is called, the first iteration returns the value of <code class="highlighter-rouge">task.selected</code> which is <code class="highlighter-rouge">false</code>, causing <em>lodash</em> to exit the iteration. Mistery solved <img class="emoji" title=":mag:" alt=":mag:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f50d.png" height="20" width="20"></p>

<figure class="example-wrapper">
  <iframe src="/examples/posts/coffeescript-js-libraries/select_all.html" frameborder="0" class="example" width="" height="254" scrolling="no"></iframe>
</figure>

<p>We can fix the bug by explicitly returning <code class="highlighter-rouge">null</code> or <code class="highlighter-rouge">true</code> on each loop, which will avoid stopping the iteration, and all the items will be unselected correctly.</p>

<figure class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="nx">selectAll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isSelected</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="na">each</span> <span class="nx">tasks</span><span class="p">,</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">task</span><span class="p">.</span><span class="na">selected</span> <span class="o">=</span> <span class="nx">isSelected</span>
    <span class="no">true</span></code></pre></figure>

<p>These are two useful features on their own, yet extremely inconvenient when combined. The reason is that the library was written for a language with a different mindset. The design of the language and the design of the library are not fully compatible.</p>

<h2 id="tldr">TL;DR</h2>
<p>Watch out for language differences when using libraries written for another language, they will bite sooner or later.</p>

  </div>

  <div class="ending">
  <div class="author">
    <a href="/" class="logo">
  <span class="text">M</span>
</a>

    <span>By</span>
    <a href="https://twitter.com/MaximoMussini" class="author-name short">@Maximo</a>
    <a href="https://twitter.com/MaximoMussini" class="author-name full">@MaximoMussini</a>
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-via="MaximoMussini" data-related="" data-show-count="false">Tweet</a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  </div>
</div>

</div>



  <a id="next-post" href="/posts/anko-vs-android-xml/" class="hidden"></a>




  <div class="previous-post">
    <div class="content container">
      <a id="previous-post" href="/posts/bash-git-prompt/" class="overlay">
        <h1>Improving your Git Experience in Bash</h1>
        <div class="post-info">
  <span class="date">December 14, 2015</span>
  <span class="reading-time">4 min read</span>
</div>

        <div class="post">
          <p><em>Bash</em> is the default terminal for most Unix distributions, so it’s very appealing to get the best out of it. If you enjoy customizing your setup, you might want to try something like <span href="http://ohmyz.sh/">zsh</span> instead, which comes with similar functionality out of the box.</p>

<p>Let’s take a look at how we can improve our <em>Git</em> usage in <em>bash</em> by adding a few plugins <img class="emoji" title=":neckbeard:" alt=":neckbeard:" src="https://github.githubassets.com/images/icons/emoji/neckbeard.png" height="20" width="20"></p>

<h2 id="bash-git-autocompletion">Bash Git Autocompletion</h2>
<p>A great way to get <em>Git</em> autocompletion is to install th…</p>
        </div>
      </a>
    </div>
  </div>



    <script>
if (document.location.hostname.search('maximomussini.com') !== -1) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-67510525-1', 'auto');
  ga('send', 'pageview');
}
</script>

<script src="/assets/js/anchors.js"></script>
<script src="/assets/js/shortcuts.js"></script>

  </body>
</html>
