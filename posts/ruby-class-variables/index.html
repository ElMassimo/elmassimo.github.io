<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>

  Class Instance Variables in Ruby · Máximo Mussini

</title>

<meta name="author" content="Máximo Mussini">
<meta name="description" content="Like most object-oriented languages, Ruby has both instance and class variables. The syntax is @name for instance variables, and @@name for class variables.

Let’s look at a simple example to understand how we might use class variables:

class Animal
  @@animals = []

  def self.all
    @@animals
  end

  def other_species
    @@animals - [self.class]
  end
end

class Dog &lt; Animal
  @@animals &lt;&lt; self…">
<meta name="keywords" content="ruby, language">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="cleartype" content="on">
<meta name="theme-color" content="#5C7E8F" />

<!-- Styles -->
<link rel="preconnect" href="//fonts.googleapis.com">
<link rel="preconnect" href="//www.google-analytics.com">
<link rel="preload" href="//fonts.googleapis.com/css?family=Raleway:700,800,900|Lato:400,400italic,700,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="this.rel='stylesheet'" type="text/css" media="screen, projection">
<link rel="stylesheet" href="/assets/css/styles.css?v=3" media="screen, projection">

<!-- Icons -->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" sizes="192x192" href="/icon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.jpg">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="Máximo Mussini · Code and Design">

<!-- Facebook Stuff -->
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:url" content="http://maximomussini.com/posts/ruby-class-variables/">
<meta property="og:site_name" content="Máximo Mussini">
<meta property="og:title" content="Class Instance Variables in Ruby">
<meta property="og:image" content="http://maximomussini.com/images/posts/ruby-class-variables.jpg">
<meta property="og:description" content="Like most object-oriented languages, Ruby has both instance and class variables. The syntax is @name for instance variables, and @@name for class variables.

Let’s look at a simple example to understand how we might use class variables:

class Animal
  @@animals = []

  def self.all
    @@animals
  end

  def other_species
    @@animals - [self.class]
  end
end

class Dog &lt; Animal
  @@animals &lt;&lt; self…">

<!-- Twitter Stuff -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:domain" value="maximomussini.com" />
<meta name="twitter:title" value="Class Instance Variables in Ruby" />
<meta name="twitter:description" value="Like most object-oriented languages, Ruby has both instance and class variables. The syntax is @name for instance variables, and @@name for class variables.

Let’s look at a simple example to understand how we might use class variables:

class Animal
  @@animals = []

  def self.all
    @@animals
  end

  def other_species
    @@animals - [self.class]
  end
end

class Dog &lt; Animal
  @@animals &lt;&lt; self…" />
<meta name="twitter:image" content="http://maximomussini.com/images/posts/ruby-class-variables.jpg" />
<meta name="twitter:url" value="http://maximomussini.com/posts/ruby-class-variables/" />

  </head>
  <body>
    <header style="background-image: url('data:image/webp;base64,UklGRhwCAABXRUJQVlA4IBACAAAwEgCdASobAWQAPtFgqVIoJKyioRQKGZAaCWdu4MiVvuQHsvh42GpKAJbQHWezu8gBTiyetFkbEcPYsRGr5LRC/ZsHLF/VvqhOzPmr+9Ih/W7yR03MoHxkyi/9N7Fv/6jvSHr/hgYOOsalmBgxJCC4pH2FdEjWVPaiKKkqej/gjRLORCnE3PAs6JuUwvYn3wVDpLfnfVrFwmYAAP6uU7pH7lz89SD/8mp/kn/DrMgcqJP8oZ8TiW9QFJt7mIHdPxG6p7JYABpXbnW6GOXfq7+BLdsK2C6NfVwiPvU7jMoYNyvq+G3pJl91GymeJ2y3tiD7O1++J8ASYunXN+49mtfz6MvSpRRu4MtPCG00DTWIC2Zv+ODnxWHBgctCkVJmG9HWY5n08auTXwyAkjMdeF/E2p1yeF8AGF7lyj8xHVU8F4dd7ruTrdLSYGqdH39+gnxBfzwanEqxHoS2kM+vEqEAb8P7h9msT2izoUp8QS4azdw72FpY1aZ/Xmw/Xh+gN3KFugJhvTSiaM2+yZJCXckfSHiNi1YxFsVwSU6wm5ltb02LSua1kXYEGiAyAFPYSWIdZ7jxsF8N+imLbe6uFHuseMOFqyqFWkbYN+aGg5RP8lpze1W0Op2/smrpKO4rAAea8CsX7S7XmDr913kdfZoSbJ2tsw7LJqjqgX2Qd9bIvCrf0nRQLjovGZUF0dIAAAA=')">
  
    <div class="hero">
      <picture>
  <source srcset="/images/posts/ruby-class-variables.webp" type="image/webp" media="(min-width: 600px)">
  <source srcset="/images/posts/ruby-class-variables-500.webp" type="image/webp">
  <img src="/images/posts/ruby-class-variables.jpg" alt="ruby-class-variables.jpg" class="hero-bg">
</source></source></picture>

      <h1 class="hero-title">Class Instance Variables in Ruby</h1>
    </div>
  
</header>

    <div class="menu container">
  <ul>
    
<li>
  <a href="/about/">About</a>
</li>

    
<li>
  <a href="/posts/">Posts</a>
</li>

    <li>
      <a href="/" class="logo">
  <img class="logo-img" src="/assets/icons/logo.svg" alt="Logo">
</a>

    </li>
    
<li>
  <a href="/projects/">Projects</a>
</li>

    
<li>
  <a href="/talks/">Talks</a>
</li>

  </ul>
  <hr>
</div>

    <div class="content container">
  

  <div class="post-info">
  <span class="date">May 30, 2016</span>
  <span class="reading-time">4 min read</span>
</div>


  <div class="post">
    <p>Like most object-oriented languages, Ruby has both instance and class variables. The syntax is <code class="language-plaintext highlighter-rouge">@name</code> for <em>instance variables</em>, and <code class="language-plaintext highlighter-rouge">@@name</code> for <em>class variables</em>.</p>

<p>Let’s look at a simple example to understand how we might use <em>class variables</em>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Animal</span>
  <span class="vc">@@animals</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span>
    <span class="vc">@@animals</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">other_species</span>
    <span class="vc">@@animals</span> <span class="o">-</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Dog</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vc">@@animals</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Cat</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vc">@@animals</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
<span class="k">end</span>

<span class="no">Animal</span><span class="p">.</span><span class="nf">all</span>
<span class="c1"># [Dog, Cat]</span>

<span class="no">Cat</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">other_species</span>
<span class="c1"># [Dog]</span>

<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">other_species</span>
<span class="c1"># [Cat]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">@@animals</code> <em>class variable</em> is <strong>shared</strong> among subclasses, and we can refer to it by using the same syntax from both class and instance methods.</p>

<h2 id="limitations-of-class-variables">Limitations of Class Variables</h2>
<p>Now, what happens if we wanted to do something different, like storing metadata or configuration in each subclass?</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Animal</span>
  <span class="vc">@@sound</span> <span class="o">=</span> <span class="s1">'?'</span>

  <span class="k">def</span> <span class="nf">talk</span>
    <span class="vc">@@sound</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Dog</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vc">@@sound</span> <span class="o">=</span> <span class="s1">'woof!'</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Cat</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vc">@@sound</span> <span class="o">=</span> <span class="s1">'meow!'</span>
<span class="k">end</span>

<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">talk</span>
<span class="c1"># "meow!"</span>

<span class="no">Cat</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">talk</span>
<span class="c1"># "meow!"</span>
</code></pre></div></div>

<p>Because <em>class variables</em> are shared between the parent class and its subclasses, the value of <code class="language-plaintext highlighter-rouge">@@sound</code> gets stepped over by the last subclass, rather than it taking a different value for each subclass as intended.</p>

<h2 id="class-instance-variables">Class Instance Variables</h2>
<p>Fortunately, there’s a simple way to achieve this in Ruby:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Animal</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sound</span>
    <span class="vi">@sound</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">talk</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">sound</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Dog</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vi">@sound</span> <span class="o">=</span> <span class="s1">'woof!'</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Cat</span> <span class="o">&lt;</span> <span class="no">Animal</span>
  <span class="vi">@sound</span> <span class="o">=</span> <span class="s1">'meow!'</span>
<span class="k">end</span>

<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">talk</span>
<span class="c1"># 'woof!'</span>

<span class="no">Cat</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">talk</span>
<span class="c1"># 'meow!'</span>
</code></pre></div></div>

<p>By using instance variables, each subclass gets its own variable so <code class="language-plaintext highlighter-rouge">@sound</code> does not get stepped over, and each subclass can configure the variable as needed. So, <em>how does it work</em>?</p>

<blockquote>
  <p>Classes in Ruby are plain objects, instances of the <code class="language-plaintext highlighter-rouge">Class</code> class.</p>
</blockquote>

<p>Let that sink in for a bit <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20"></p>

<blockquote>
  <p>Because each class is an object, it can have instance variables just like any other Ruby object.</p>
</blockquote>

<p>Although they are often called <em>class instance variables</em> to differentiate them from actual <em>class variables</em>, there’s nothing special about them—they are just plain ole’ instance variables.</p>

<p>The key practical difference is that <em>class variables</em> (<code class="language-plaintext highlighter-rouge">@@</code>) are shared among a class and all of its descendants, whereas <em>class instance variables</em> (<code class="language-plaintext highlighter-rouge">@</code>) are not shared and each class has separate instance variables just like you would expect from different objects.</p>

<h3 id="limitations-of-class-instance-variables">Limitations of Class Instance Variables</h3>
<p>It’s worth noting that in the last example we lost the convenience of referencing the <code class="language-plaintext highlighter-rouge">@sound</code> variable directly on the <code class="language-plaintext highlighter-rouge">talk</code> method like we did in the <a href="#limitations-of-class-variables">second example</a>, and instead need to define a getter method at the class level in order to access it.</p>

<p>This is because the same syntax is used for regular <em>instance variables</em>, so we can only refer to class instance variables directly when we are in the class scope—like in <strong>class methods</strong> and in the <strong>top-level context</strong> of a class definition.</p>

<p>Also, since we can’t use <em>class instance variables</em> to share values between a class and its descendants, in cases where we would like to access the variable of a parent class we will need to refer to it using a fully qualified getter (such as <code class="language-plaintext highlighter-rouge">Animal.sound</code>) or use <a href="https://github.com/ElMassimo/queryable/blob/7c5eb3448456e6e84a907cbf4a567c576433428a/lib/queryable/default_scope.rb#L38-L50">metaprogramming</a> in order to achieve that.</p>

<h2 id="driving-it-home-house-car">Driving it home <img class="emoji" title=":house:" alt=":house:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f3e0.png" height="20" width="20"> <img class="emoji" title=":car:" alt=":car:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f697.png" height="20" width="20">
</h2>
<p>In general, <em>class instance variables</em> are the way to go because they are not shared, which is very useful when building libraries or DSLs, and we don’t run the risk of the value getting stepped over by accident in a subclass.</p>

<p>On the other hand, when the variable must be shared by a class and its descendants we should always use <em>class variables</em>.</p>

<p>When inheritance is not in play we can use either, but it’s better to be consistent and pick a “default”. I always use <em>class instance variables</em> unless I actually need the variable to be shared.</p>

<p>We should now be less fuzzy on what <code class="language-plaintext highlighter-rouge">@</code> means when used in class methods or in a class definition, and when to use <em>class instance variables</em> instead of <em>class variables</em> <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20"></p>

<p><em>Would you like to <a href="/posts/ruby-to_proc/">learn about Ruby’s <code class="language-plaintext highlighter-rouge">Symbol</code> shortcuts</a>?</em></p>

  </div>

  <div class="ending">
  <a href="/" class="logo">
  <img class="logo-img" src="/assets/icons/logo.svg" alt="Logo">
</a>

  <span>by</span>
  <a href="https://twitter.com/MaximoMussini" class="author-name">Máximo<span class="last-name"> Mussini</span></a>
  <a class="twitter-share-button" href="//twitter.com/intent/tweet?original_referer=http://maximomussini.com/posts/ruby-class-variables/&amp;ref_src=twsrc%5Etfw&amp;text=Class%20Instance%20Variables%20in%20Ruby%20%C2%B7%20M%C3%A1ximo%20Mussini&amp;tw_p=tweetbutton&amp;url=http://maximomussini.com/posts/ruby-class-variables/&amp;via=MaximoMussini" rel="noopener" target="_blank"><i class="twitter-icon"></i><span class="twitter-label">Tweet</span></a>

</div>

</div>



  <a id="next-post" href="/posts/mongoid-aggregation-dsl/" class="hidden"></a>




  <a id="previous-post" href="/posts/angular-less-watchers/" class="hidden"></a>




  <div class="related-post">
    <div class="content container">
      <a id="related-post" href="/posts/ruby-double-splat-keywords/" class="overlay">
        <h1>Ruby Keywords and the Double Splat Operator</h1>
        <div class="post-info">
  <span class="date">January 30, 2020</span>
  <span class="reading-time">3 min read</span>
</div>

        <div class="post">
          <p>One of the nicest bits of syntax sugar in Ruby are <em>keywords</em> (<code class="language-plaintext highlighter-rouge">**</code> or <em>double-splat</em>).</p>

<h2 id="keywords-in-method-parameters">Keywords in Method Parameters</h2>

<p>Just like the splat operator (<code class="language-plaintext highlighter-rouge">*args</code>) captures any parameters as an <code class="language-plaintext highlighter-rouge">Array</code> of
arguments, the double-splat operator (<code class="language-plaintext highlighter-rouge">**attrs</code>) captures any option parameters
as a <code class="language-plaintext highlighter-rouge">Hash</code>.</p>

<p>The nice thing is that it allows to destructure a <code class="language-plaintext highlighter-rouge">Hash</code> argument into any of
its individual keys, and mark it as r…</p>
        </div>
      </a>
    </div>
  </div>



    <script>
if (document.location.hostname.search('maximomussini.com') !== -1) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-67510525-1', 'auto');
  ga('send', 'pageview');
}
</script>

<script src="/assets/js/anchors.js" async></script>
<script src="/assets/js/shortcuts.js" async></script>

  </body>
</html>
